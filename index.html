<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Apfel, fertig, los! - Strukturierte Linien-Version</title>
<style>
  :root {
    --bg: #0b0f14;
    --fg: #e7eef7;
    --muted: #c7d3e1;
    --road: #93a8c0;
    --accent: #ffdd57;
    --panel: rgba(0, 0, 0, 0.55);
    --viewport-width: 900;
    --viewport-height: 520;
    --viewport-ratio: calc(var(--viewport-width) / var(--viewport-height));
  }

  html,
  body {
    margin: 0;
    height: 100%;
    background: var(--bg);
    color: var(--fg);
    overflow: hidden;
  }

  body {
    display: grid;
    place-items: center;
  }

  .game-frame {
    width: min(100vw, calc(100vh * var(--viewport-ratio)));
    height: min(100vh, calc(100vw / var(--viewport-ratio)));
    aspect-ratio: var(--viewport-width) / var(--viewport-height);
  }

  canvas {
    width: 100%;
    height: 100%;
    display: block;
  }
  /* EMBEDDED_FONTS_START */
  @font-face {
    font-family: 'PixelHigh';
    src: url("data:font/ttf;base64,AAEAAAAOAIAAAwBgRkZUTW6plWIAAC44AAAAHEdERUYApQAkAAAuEAAAAChPUy8yhblxVwAAAWgAAABWY21hcFY5awEAAAOYAAABkmN2dCAAIgKIAAAFLAAAAARnYXNw//8AAQAALggAAAAIZ2x5ZsdQUeUAAAYgAAAlFGhlYWQdmLV/AAAA7AAAADZoaGVhBR4DtwAAASQAAAAkaG10eJ9LAGIAAAHAAAAB2GxvY2EjAhoYAAAFMAAAAO5tYXhwAMUAeQAAAUgAAAAgbmFtZS4hBrEAACs0AAABmHBvc3Ts+Pv5AAAszAAAATsAAQAAAAEAACYFx0dfDzz1AB8EAAAAAADeMrlBAAAAAN4yuUEAAP9AAgACwAAAAAgAAgAAAAAAAAABAAACwP9AAFwEAAAAAAACAAABAAAAAAAAAAAAAAAAAAAAdgABAAAAdgBIAA0AAAAAAAIAAAABAAEAAABAAC4AAAAAAAEBdQH0AAUAAAKZAswAAACPApkCzAAAAesAMwEJAAACAAYDAAAAAAAAAAAAAwABAAIAAAAAAAAAADJ0dGYAQAAgMAADAP8AAFwCwADAAAAAAQAAAAAAAAF2ACIAAAAAAVUAAAFAAAAAgAAAAQAAAAGAAAABgAAAAYAAAAJAAAAAgAAAAQAAAAEAAAABAAAAAQAAAACAAAABAAAAAIAAAAGAAAABgAAAAQAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAIAAAACAAAABAAAAAQAAAAEAAAABgAAAAgAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAUAAAAGAAAABgAAAAYAAAAIAAAABwAAAAYAAAAGAAAABgAAAAYAAAAGAAAABQAAAAYAAAAGAAAACAAAAAYAAAAGAAAABgAAAAQAAAAGAAAABAAAAAQAAAAEAAAAAwAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABQAAAAYAAAAGAAAABgAAAAgAAAAHAAAABgAAAAYAAAAGAAAABgAAAAYAAAAFAAAABgAAAAYAAAAIAAAABgAAAAYAAAAGAAAABAAAAAIAAAAEAAAABQAAAAUAAAACAAAABgAAAAYAAAAIAAAABAAAAAYAAAAIAAAABQAAAAQAAAAEAAAABAAAAAIAAAAFAAEAAwAAAAQAAAAGAAAABgAAAAYAAAAQAAAAAAAADAAAAAwAAABwAAQAAAAAAjAADAAEAAAAcAAQAcAAAABgAEAADAAgAfgChAKMApQCrAK4AtAC7AL8grDAA//8AAAAgAKAAowClAKkArgCwALgAvyCsMAD////j/8L/wf/A/73/u/+6/7f/tN/I0HUAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQYAAAEAAAAAAAAAAQIAAAACAAAAAAAAAAAAAAAAAAAAAQAAAwQFBgcICQoLDA0ODxAREhMUFRYXGBkaGxwdHh8gISIjJCUmJygpKissLS4vMDEyMzQ1Njc4OTo7PD0+P0BBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWltcXV5fYGEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAagBkAAAAAGlmAG4AAAAAAGsAAGUAAAAAAABncQAAAHNjAAAAAABocgBiAAAAAAAAAAAAAAAAAAAAAHQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAG8AAAAAAAAiAogAAAAqACoAKgAqAEQAWgCMAMoBHgFsAXoBogHIAegB/AIKAhoCJgJOAnwCmALQAwgDMgNmA5wDxgQABDYERgRaBHoEkgSyBN4FKgVaBZAFwgXuBhQGNAZoBpQGtgbgBxAHMAdkB5YHxAfwCCQIVgiQCKwI2AkCCTYJaAmaCc4J7gocCjwKVApkCnYKpgrcCw4LOgtgC4ALtAvgDAIMLAxcDHwMsAzgDQ4NOg1uDaAN2A30DiAOSg5+DrAO4g8WD0APVg9+D5oPmg+0D+oQIhByEJAQyhEWEToRVhF2EZIRoBG4EcwR7BImElISihKKAAAAAgAiAAABMgKqAAMABwAusQEALzyyBwQA7TKxBgXcPLIDAgDtMgCxAwAvPLIFBADtMrIHBgH8PLIBAgDtMjMRIREnMxEjIgEQ7szMAqr9ViICZgAAAgAAAAAAQALAAAMAFwAAMTUzFSc9CDMdCEBAQEBAgEBAQEBAQEBAQEBAQEBAQEBAQAAAAAIAAAJAAMACwAAFAAsAABM9ATMdASM9ATMdAYBAwEACQEBAQEBAQEBAAAAAAgAAAEABQAIAACMAJwAANz0BIx0BIz0BIzUzNSM1Mz0BMx0BMz0BMx0BMxUjFTMVIx0BJzUjFcBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQMBAQAAAAAEAAP+AAUACwAA3AAAXPQEjNSM9ATsBHQEzPQIrATUjPQIzNTM9ATMdATMVMx0BKwE9ASMdAjsBFTMdAiMVIx0BgEBAQEBAQEBAQEBAQEBAQEBAQEBAQIBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAANAAAAAAFAAsAAAwAJAA0AEQAVABkAHwAnAC0AMwA3ADsAPwAAMzUzFSE9ATMdARE1MxUTNTMVKwE1OwEjNTMHIz0BMxU9AzMdAj0CMx0BPQIzHQErATUzByM1OwEjNTPAQP8AQECAQIBAQEBAQIBAQEBAQIBAQIBAQEBAQEBAQEBAQAIAQED+QEBAQEBAQEBAQEBAQEBAQMBAQEBAgEBAQEBAQEBAAAADAAAAAAIAAsAAMQBBAEcAACEjNSMVKwM1Iz0FMzUjPQEzNTsCFTMdASMVMx0CMzU7ARUjFSMVMxUzFSU1MzUjPQMjHQUTPQEjHQEBwEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBA/sBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAHAQEBAQAAAAAABAAACQABAAsAABQAAET0BMx0BQAJAQEBAQAAABQAAAAAAwALAAAMABwAXABsAHwAAMzUzFScjNTMrAT0GMx0FETUzFT0BMxWAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEABgEBAQEBAAAAFAAAAAADAAsAAAwAHABcAGwAfAAAxNTMVPQEzFT0HMx0GAyM1MysBNTNAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAHAQEAABQAAAgAAwALAAAMABwALAA8AEwAAEzUzFSM1MxU3IzUzMTUzFSsBNTOAQMBAQEBAQIBAQAIAQEBAQEBAQEBAAAEAAABAAMABAAALAAA3NSM1MzUzFTMVIxVAQEBAQEBAQEBAQEBAAAABAAD/wABAAEAABQAAFT0BMx0BQEBAQEBAAAAAAQAAAIAAwADAAAcAADczFSsCNTOAQEBAQEDAQEAAAAABAAAAAABAAEAAAwAAMTUzFUBAQAAAAAAFAAAAAAFAAsAABQALABMAGQAfAAAxPQEzHQE9AjMdAT0DMx0CPQIzHQE9AjMdAUBAQEBAQEBAQIBAQEBAgEBAQEBAQMBAQEBAgEBAQEAAAAIAAAAAAUACwAAfADMAADMrATUjPQgzNTsCFTMdCCMVJz0IIx0IwEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAAAQAAAAAAwALAABsAADMjPQcjNTM9ATsBHQqAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAABAAAAAAFAAsAAMQAAISsDPQIzPQEzPQEzPQIjHQErAT0BMzU7AhUzHQIjHQEjHQEjHQEzNTsBHQEBAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAAAAAAAQAAAAABQALAADUAADMrATUjPQM7AR0DMz0EIzUzPQIjHQErAT0BMzU7AhUzHQIjFTMdBCMVwEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAAAAAEAAAAAAUACwAAvAAAhIzUrAj0IOwEdBzM9CDsBHQoBAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAAAAAEAAAAAAUACwAA3AAAzKwE1Iz0EOwEdBDM9BiMVKwE9AzsEFSsCFTsBFTMdBiMVwEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAAAgAAAAABQALAACkANQAAMysBNSM9CDM1OwIVMx0BKwE9ASMdAjsBFTMdBCMVJz0EIx0EwEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAQAAAAABQALAACcAADMjPQQzPQEzPQIjHQErAT0COwQdAyMdASMdBIBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAAAAAAAwAAAAABQALAACMAMQA3AAAzKwE1Iz0FMzUjPQEzNTsCFTMdASMVMx0FIxUnPQUjHQUTPQEjHQHAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAHAQEBAQAACAAAAAAFAAsAAJwA1AAAzKwE1IzU7ARUzPQErATUjPQUzNTsCFTMdCCMVAz0FIx0FwEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAQBAQEBAQEBAQEBAQEAAAAACAAAAAABAAMAAAwAHAAAxNTMVJzUzFUBAQEBAgEBAAAIAAP/AAEAAwAAFAAkAABU9ATMdASc1MxVAQEBAQEBAQMBAQAAAAAAFAAAAAADAAUAAAwAHAAsADwATAAAzNTMVJyM1MysBNTMxNTMVPQEzFYBAQEBAQEBAQEBAQEBAQEBAQEBAAAAAAgAAAEAAwAEAAAcADwAANzMVKwI1MzczFSsCNTOAQEBAQEBAQEBAQECAQECAQEAABQAAAAAAwAFAAAMABwALAA8AEwAAMTUzFT0BMxU9ATMVJyM1MysBNTNAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAAIAAAAAAUACwAADACUAADM1MxUnPQIzPQMjHQIrAT0CMzU7AhUzHQMjHQEjFYBAQEBAQEBAQEBAQEBAQEDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAAAHAAAAAAHAAcAABwAhACkALQAxADUAPQAAJTMVKwI1OwE1KwIVIzUzPQEzNTsBHQEzPQEzHQIjFSUjPQIzHQEzNSMVNyM1MwU1MxU3KwI1OwIBAEBAQEBAgEBAQEBAQEBAQEBA/sBAQMBAwEBA/sBAwEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQECAQEBAQEBAAAIAAAAAAUACwAAhADMAACEjNSMVKwE9CTM1OwIVMx0JJz0HIx0HAQBAQEBAQEBAQECAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQIBAQEBAQEBAQEBAQEBAQEBAAAAAAAMAAAAAAUACwAAhAC8ANQAAMysCPQo7AxUzHQEjFTMdBSMVJz0FIx0FEz0BIx0BwEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAcBAQEBAAAAAAAEAAAAAAUACwAA1AAAzKwE1Iz0IMzU7AhUzHQYrAT0GIx0IMzU7ARUjFcBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAAACAAAAAAFAAsAAHwAzAAAzKwI9CjsDFTMdCCMVJz0IIx0IwEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAAAQAAAAABQALAACcAACUzFSsEPQo7BBUrAh0GMxUjFTMBAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAAAAEAAAAAAUACwAAhAAAzIz0KOwQVKwIdBjMVIx0BQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAACAAAAAAFAAsAAMQA1AAAhKwI1Iz0IMzU7AhUzHQUrAT0FIx0GOwIdAic1IxUBAEBAQEBAQEBAQEBAQEBAQIBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAAEAAAAAAUACwAAzAAAhIzUjFSsBPQo7AR0IMz0IOwEdCgEAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAABAAAAAAEAAsAAIQAAMysCNTM9CCM1OwMVIx0IMxXAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAAAAAEAAAAAAUACwAArAAAzKwE1Iz0BOwEdATM9CCMVKwE9ATsEHQkjFcBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAEAAAAAAUACwAA1AAAhIzUjFSsBPQo7AR0IMz0IMxUzHQcjFTMVAQBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAAEAAAAAAUACwAAhAAAhKwM9CjsBHQkzNTsBHQEBAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAABAAAAAAHAAsAANwAAEzUjHQQrAT0KOwEVMx0CMz0CMzU7AR0KKwE9BCMVwEBAQEBAQEBAQEBAQEABAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAAIAAAAAAYACwAAbADcAACEjNSM1Mz0IOwEdCiEjPQo7AR0HMxUjHQEBQEBAQEBA/sBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAACAAAAAAFAAsAAHwAzAAAzKwE1Iz0IMzU7AhUzHQgjFSc9CCMdCMBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAIAAAAAAUACwAAfADEAADMjPQo7AxUzHQcjFSsBFTc9ByMdB0BAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQECAQEBAQEBAQEBAQEBAQEBAQAACAAD/wAFAAsAAIwA3AAAFIzUrATUjPQgzNTsCFTMdCCMVMxUnPQgjHQgBAEBAQEBAQEBAQEBAgEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAgEBAQEBAQEBAQEBAQEBAQEBAQAAAAAIAAAAAAUACwAAjADUAACEjNSMVKwE9CjsDFTMdByMVMxUnPQcjHQcBAEBAQEBAQEBAQEBAgEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQECAQEBAQEBAQEBAQEBAQEBAQAAAAAABAAAAAAFAAsAANwAAMysBNSM9AjsBHQIzPQMrATUjPQMzNTsCFTMdAisBPQIjHQM7ARUzHQMjFcBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAAAAAEAAAAAAQACwAAdAAAzIz0JIzU7AxUjHQmAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAAAQAAAAABQALAADMAADMrATUjPQk7AR0JMz0JOwEdCSMVwEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAAEAAAAAAUACwAAvAAAzNSM1Iz0IOwEdBzM9BzsBHQgjFSMVgEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAEAAAAAAcACwAA3AAAhNSMVIzUjNSM9CDsBHQczNTMVMz0HOwEdCCMVIxUBAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAAAAAAAQAAAAABQALAADcAACEjNSMVKwE1MzUjPQg7AR0IMz0IOwEdCCMVMxUBAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAAAAEAAAAAAUACwAA1AAAzKwE1IzU7ARUzPQErATUjPQY7AR0GMz0GOwEdCSMVwEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAABAAAAAAFAAsAALwAAISsDPQIzPQEzPQEzPQIjFSsBPQE7BB0DIx0BIx0BIx0BMzU7AR0BAQBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAAEAAAAAAMACwAAfAAA3MxUrAj0KOwIVKwEdCIBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAAAFAAAAAAFAAsAABQALABMAGQAfAAAhPQEzHQEnIz0BMxUnIz0CMx0BJyM9ATMVJyM9ATMVAQBAQEBAQEBAQEBAQEBAQEBAQIBAQEBAQEBAQECAQEBAQEBAQAAAAAEAAAAAAMACwAAfAAAzKwE1OwE9CCsBNTsCHQqAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAAADAAACQADAAsAAAwAHAAsAABM1MxUjNTMVNyM1M4BAwEBAQEACQEBAQEBAQAAAAAABAAD/gADA/8AABwAAFzMVKwI1M4BAQEBAQEBAQAAAAAIAAAJAAIACwAADAAcAABM1MxUnIzUzQEBAQEACQEBAQEAAAAIAAAAAAUACwAAhADMAACEjNSMVKwE9CTM1OwIVMx0JJz0HIx0HAQBAQEBAQEBAQECAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQIBAQEBAQEBAQEBAQEBAQEBAAAAAAAMAAAAAAUACwAAhAC8ANQAAMysCPQo7AxUzHQEjFTMdBSMVJz0FIx0FEz0BIx0BwEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAcBAQEBAAAAAAAEAAAAAAUACwAA1AAAzKwE1Iz0IMzU7AhUzHQYrAT0GIx0IMzU7ARUjFcBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAAACAAAAAAFAAsAAHwAzAAAzKwI9CjsDFTMdCCMVJz0IIx0IwEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAAAQAAAAABQALAACcAACUzFSsEPQo7BBUrAh0GMxUjFTMBAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAAAAEAAAAAAUACwAAhAAAzIz0KOwQVKwIdBjMVIx0BQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAACAAAAAAFAAsAAMQA1AAAhKwI1Iz0IMzU7AhUzHQUrAT0FIx0GOwIdAic1IxUBAEBAQEBAQEBAQEBAQEBAQIBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAAEAAAAAAUACwAAzAAAhIzUjFSsBPQo7AR0IMz0IOwEdCgEAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAABAAAAAAEAAsAAIQAAMysCNTM9CCM1OwMVIx0IMxXAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAAAAAEAAAAAAUACwAArAAAzKwE1Iz0BOwEdATM9CCMVKwE9ATsEHQkjFcBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAEAAAAAAUACwAA1AAAhIzUjFSsBPQo7AR0IMz0IMxUzHQcjFTMVAQBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAAEAAAAAAUACwAAhAAAhKwM9CjsBHQkzNTsBHQEBAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAABAAAAAAHAAsAANwAAEzUjHQQrAT0KOwEVMx0CMz0CMzU7AR0KKwE9BCMVwEBAQEBAQEBAQEBAQEABAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAAEAAAAAAYACwAA1AAAhIzUjNSMdASsBPQo7AR0GMxUzPQc7AR0KAUBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAAIAAAAAAUACwAAfADMAADMrATUjPQgzNTsCFTMdCCMVJz0IIx0IwEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAAAgAAAAABQALAAB8AMQAAMyM9CjsDFTMdByMVKwEVNz0HIx0HQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQIBAQEBAQEBAQEBAQEBAQEBAAAIAAP/AAUACwAAjADcAAAUjNSsBNSM9CDM1OwIVMx0IIxUzFSc9CCMdCAEAQEBAQEBAQEBAQECAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQECAQEBAQEBAQEBAQEBAQEBAQEBAAAAAAgAAAAABQALAACMANQAAISM1IxUrAT0KOwMVMx0HIxUzFSc9ByMdBwEAQEBAQEBAQEBAQECAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQIBAQEBAQEBAQEBAQEBAQEBAAAAAAAEAAAAAAUACwAA3AAAzKwE1Iz0COwEdAjM9AysBNSM9AzM1OwIVMx0CKwE9AiMdAzsCHQQjFcBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAABAAAAAAEAAsAAHQAAMyM9CSM1OwMVIx0JgEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAEAAAAAAUACwAAzAAAzKwE1Iz0JOwEdCTM9CTsBHQkjFcBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAAAAABAAAAAAFAAsAALwAAMzUjNSM9CDsBHQczPQc7AR0IIxUjFYBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAABAAAAAAHAAsAANwAAITUjFSM1IzUjPQg7AR0HMzUzFTM9BzsBHQgjFSMVAQBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAAAAAEAAAAAAUACwAA3AAAhIzUjFSsBNTM1Iz0IOwEdCDM9CDsBHQgjFTMVAQBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAABAAAAAAFAAsAANQAAMysBNSM1OwEVMz0BKwE1Iz0GOwEdBjM9BjsBHQkjFcBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAQAAAAABQALAAC8AACErAz0CMz0BMz0BMz0CIxUrAT0BOwQdAyMdASMdASMdATM1OwEdAQEAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAAAAAFAAAAAADAAsAAAwANABEAGwAfAAAzNTMVJyM9AzMdAicjNTMxPQMzHQMRNTMVgEBAQEBAQEBAQEBAQEBAQEBAQEDAQEBAQEBAQEBAAQBAQAAAAAABAAAAAABAAsAAFwAAMT0KMx0KQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAAAAUAAAAAAMACwAADAA0AEQAbAB8AADE1MxU9BDMdAxE1MxUnIz0DMx0CJyM1M0BAQEBAQEBAQEBAQEBAQEBAQEBAAQBAQEBAQEBAQEBAwEAABAAAAEABAADAAAMABwALAA8AADc1MxUjNTMVNzUzFSsBNTOAQMBAgECAQEBAQEBAQEBAQEAAAAACAAAAAABAAsAAEwAXAAAxPQgzHQgDNTMVQEBAQEBAQEBAQEBAQEBAQEBAQEBAAoBAQAAAAQAAAAABQALAADMAACUzFSsEPQEzNSM1MzUjPQQzNTsCFTMdAisBPQIjHQQzFTMVIxUjFTMBAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAAAQAAAAABQALAADcAADM1KwE1OwE1KwE1MzUjPQU7AR0FMz0FOwEdBSMVMxUrARU7ARUrARWAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAAkAAAAAAcABwAAHAAsADwAXACcALwAzADcAPwAAJTMVKwI1OwE1MxUhIzUzIT0CMx0CKwM9AjsCFSsBFTsBBSM9AjMdASUjNTMFIzU7ASsCNTsCAQBAQEBAQIBA/wBAQAEAQIBAQEBAQEBAQEBA/wBAQAFAQED/AEBAwEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAgEBAQEAAAAACAAABwADAAsAADwATAAATNSMVIz0CMxUzNTMdAicjNTOAQEBAQEBAQEABwEBAQEBAQEBAQEDAQAAAAAAKAAAAAAFAAUAAAwAHAAsADwATABcAGwAfACMAJwAAITUzFSM1MxU3IzUzByM1OwEjNTMHIzU7ATUzFSsBNTsBNTMVKwE1MwEAQMBAQEBAgEBAQEBAgEBAgECAQECAQIBAQEBAQEBAQEBAQEBAQEBAQEBAAAcAAAAAAcABwAAHAAsADwAXABsAOwA/AAAlMxUrAjU7ATUzFSEjNTMhPQIzHQIrATUzBz0CIx0CIz0CMzUzNTsCFTMVIzUjFTMVIxUjFT0BIxUBAEBAQEBAgED/AEBAAQBAgEBAwEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEDAQEAABAAAAcABAALAAAUACwARABcAABMzFSsBNTM9ATMdASsBPQEzFTcrATU7AYBAQECAQMBAQIBAQEBAAgBAQEBAQEBAQEBAQAAAAgAAAEAAwAGAAAsAEwAANzUjNTM1MxUzFSMdATMVKwI1M0BAQEBAQEBAQEBAwEBAQEBAQEBAQAADAAABwADAAsAACQANABMAABMrATUzNTMVMxUnNTMVJysBNTsBgEBAQEBAQEBAQEBAQAHAQEBAQIBAQEBAAAAAAgAAAcAAwALAAAsAEQAAEysBNTM1MzUzHQInKwE1OwGAQEBAQEBAQEBAQAHAQEBAQEBAwEAAAAABAAACQABAAsAABQAAET0BMx0BQAJAQEBAQAAAAwBA/0ABAAAAAAUACQANAAAXMxUrATUzNTMVJyM1M4BAQECAQEBAQIBAQEBAQEAAAQAAAcAAgALAAAsAABM9ASM1MzUzHQNAQEBAAcBAQEBAQEBAQAAAAAQAAAHAAMACwAADAAkADwATAAATNTMVPQIzHQErAT0BMxU3IzUzQEBAgEBAQEBAAcBAQEBAQEBAQEBAQEAAAAAKAAAAAAFAAUAAAwAHAAsADwATABcAGwAfACMAJwAAMzUzFSM1MxU3NTMVKwE1OwE1MxUrATU7ASM1MwcjNTsBIzUzByM1M4BAwECAQIBAQIBAgEBAQEBAgEBAQEBAgEBAQEBAQEBAQEBAQEBAQEBAQEAAAAIAAAAAAUACwAADACUAABM1MxURKwE1Iz0DMz0BMzUzHQIjHQMzPQI7AR0CIxWAQEBAQEBAQEBAQEBAAoBAQP2AQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAABAAAAAAFAAsAANQAAMysBNSM9CDM1OwIVMx0CKwE9AiMdAzsBFSsBFTsBFSsBHQEzNTsBFSMVwEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAAAAAAOAK4AAQAAAAAAAAAGAA4AAQAAAAAAAQAJACkAAQAAAAAAAgAGAEEAAQAAAAAAAwAQAGoAAQAAAAAABAAJAI8AAQAAAAAABQAQALsAAQAAAAAABgAJAOAAAwABBAkAAAAMAAAAAwABBAkAAQASABUAAwABBAkAAgAMADMAAwABBAkAAwAgAEgAAwABBAkABAASAHsAAwABBAkABQAgAJkAAwABBAkABgASAMwATABhAG4AYQBSAG8AAExhbmFSbwAAUABpAHgAZQBsAEgAaQBnAGgAAFBpeGVsSGlnaAAATQBlAGQAaQB1AG0AAE1lZGl1bQAATABhAG4AYQBSAG8AOgBQAGkAeABlAGwASABpAGcAaAAATGFuYVJvOlBpeGVsSGlnaAAAUABpAHgAZQBsAEgAaQBnAGgAAFBpeGVsSGlnaAAAVgBlAHIAcwBpAG8AbgAgADAAMAAxAC4AMAAwADAAIAAAVmVyc2lvbiAwMDEuMDAwIAAAUABpAHgAZQBsAEgAaQBnAGgAAFBpeGVsSGlnaAAAAgAAAAAAAP+AADMAAAAAAAAAAAAAAAAAAAAAAAAAAAB2AAAAAQACAAMABAAFAAYABwAIAAkACgALAAwADQAOAA8AEAARABIAEwAUABUAFgAXABgAGQAaABsAHAAdAB4AHwAgACEAIgAjACQAJQAmACcAKAApACoAKwAsAC0ALgAvADAAMQAyADMANAA1ADYANwA4ADkAOgA7ADwAPQA+AD8AQABBAEIAQwBEAEUARgBHAEgASQBKAEsATABNAE4ATwBQAFEAUgBTAFQAVQBWAFcAWABZAFoAWwBcAF0AXgBfAGAAYQECAKMAhQCWAIsAnQCpAIoAgwCTAQMBBACNAN4BBQCeAKoAogEGAQcHdW5pMDBBMAd1bmkwMEIyB3VuaTAwQjMHdW5pMDBCOQRFdXJvB3VuaTMwMDAAAAAAAf//AAAAAQAAAA4AAAAYACAAAAACAAEAAQB1AAEABAAAAAIAAAABAAAAAQAAAAAAAQAAAADH/rDfAAAAAMh4K0EAAAAA3jK5QQ==") format('truetype');
    font-weight: normal;
    font-style: normal;
    font-display: swap;
  }
  @font-face {
    font-family: 'PixelMiddle';
    src: url("data:font/ttf;base64,AAEAAAAOAIAAAwBgRkZUTW6pmwsAACYkAAAAHEdERUYAnwAkAAAl/AAAAChPUy8yhblxNwAAAWgAAABWY21hcFbi6c4AAAOAAAABomN2dCAAIgKIAAAFJAAAAARnYXNw//8AAQAAJfQAAAAIZ2x5ZrDzXLIAAAYMAAAdIGhlYWQdWMC7AAAA7AAAADZoaGVhBMgDsQAAASQAAAAkaG10eJNLAGIAAAHAAAABwGxvY2GcXZV8AAAFKAAAAOJtYXhwAMEAbQAAAUgAAAAgbmFtZViWKQ0AACMsAAABsHBvc3TY7lJdAAAk3AAAARcAAQAAAAEAAEsg2ulfDzz1AB8EAAAAAADeMr7qAAAAAN4yvuoAAP9AAcACqgAAAAgAAgAAAAAAAAABAAACqv9AAFwEAAAAAAABwAABAAAAAAAAAAAAAAAAAAAAcAABAAAAcAA8AA8AAAAAAAIAAAABAAEAAABAAC4AAAAAAAEBawH0AAUAAAKZAswAAACPApkCzAAAAesAMwEJAAACAAYDAAAAAAAAAAAAAwABAAIAAAAAAAAAADJ0dGYAQAAgMAADAP8AAFwCqgDAAAAAAQAAAAAAAAF2ACIAAAAAAVUAAAFAAAAAgAAAAQAAAAGAAAABgAAAAgAAAAIAAAAAgAAAAQAAAAEAAAABAAAAAQAAAACAAAABAAAAAIAAAAEAAAABgAAAAQAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAIAAAACAAAAAwAAAAQAAAADAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABQAAAAUAAAAGAAAABgAAAAUAAAAGAAAABgAAAAUAAAAIAAAABwAAAAYAAAAGAAAABgAAAAYAAAAGAAAABQAAAAYAAAAGAAAACAAAAAYAAAAGAAAABgAAAAMAAAAEAAAAAwAAAAQAAAAEAAAAAgAAAAYAAAAGAAAABgAAAAYAAAAFAAAABQAAAAYAAAAGAAAABQAAAAYAAAAGAAAABQAAAAgAAAAHAAAABgAAAAYAAAAGAAAABgAAAAYAAAAFAAAABgAAAAYAAAAIAAAABgAAAAYAAAAGAAAABAAAAAIAAAAEAAAABQAAAAUAAAACAAAABgAAAAQAAAAGAAAABQAAAAYAAAAEAAAAAgAAAAUAAQAFAAAABgAAAAYAAAAQAAAAAAAADAAAAAwAAABwAAQAAAAAAnAADAAEAAAAcAAQAgAAAABwAEAADAAwAfgChAKMAqQCrAK4AsQC0ALgAuwC/IKwwAP//AAAAIACgAKMAqACrAK4AsQC0ALgAuwC/IKwwAP///+P/wv/B/73/vP+6/7j/tv+z/7H/rt/C0G8AAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEGAAABAAAAAAAAAAECAAAAAgAAAAAAAAAAAAAAAAAAAAEAAAMEBQYHCAkKCwwNDg8QERITFBUWFxgZGhscHR4fICEiIyQlJicoKSorLC0uLzAxMjM0NTY3ODk6Ozw9Pj9AQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVpbXF1eX2BhAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAZAAAAABoZgBqZQAAAABpAAAAAAAAAAAAAAAAAABtYwAAAAAAZ2wAYgAAAAAAAAAAAAAAAAAAAABuAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABrAAAAAAAAIgKIAAAAKgAqACoAKgBAAFYAgACoAQABQgFQAXQBlgG2AcoB2AHoAfQCEAI2Ak4CegKoAsoC9gMkA0QDdgOkA7QDyAPeA/YEDAQwBF4EhgSyBNwFAAUgBTwFaAWMBaoFzgX2Bg4GOgZkBooGrgbaBwQHNAdMB3AHlAfAB+oIDgg6CFIIcAiICKAIsAi+COYJEgk8CWAJgAmcCcgJ7AoKCi4KVgpuCpoKxArqCw4LOgtkC5QLrAvQC/QMIAxKDG4Mmgy+DNAM9A0QDRANJg1SDWQNlA26Dd4N+A4GDh4ORA5qDpAOkAAAAAIAIgAAATICqgADAAcALrEBAC88sgcEAO0ysQYF3DyyAwIA7TIAsQMALzyyBQQA7TKyBwYB/DyyAQIA7TIzESERJzMRIyIBEO7MzAKq/VYiAmYAAAIAAAAAAEABwAADAA8AADE1MxUnPQQzHQRAQEBAQIBAQEBAQEBAQEBAAAAAAgAAAUAAwAHAAAUACwAAEz0BMx0BIz0BMx0BgEDAQAFAQEBAQEBAQEAAAAACAAAAQAFAAYAAGwAfAAA3NSMVIzUjNTM1IzUzNTMVMzUzFTMVIxUzFSMVJzUjFcBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQECAQEAAAAABAAD/wAFAAYAAHwAAFzUjNTsBNSsCPQEzNTM1MxUzFSsBFTsCHQEjFSMVgEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAAAAA8AAAAAAcABwAADAAcACwAPABMAFwAbAB8AIwAnACsALwAzADcAOwAAITUzFSE1MxURNTMVBTUzFSsBNTMFNTMVJSM1MwU1MxU9ATMVPQEzFT0BMxUhNTMVKwE1MyE1MxUhIzUzAUBA/oBAQAEAQIBAQP8AQAEAQED/AEBAQED/AECAQEABQED+wEBAQEBAQAEAQEDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAABQAAAAABwAHAAAMAIQArAC8AMwAAJTUzFQUrATUjPQIzNSM1MzU7AhUzFSMVMxUzFSMVIxUnNTM1IzUjHQIlNTMVJTUjFQGAQP8AQEBAQEBAQEBAQEBAQEBAQEBAQAEAQP8AQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQECAQECAQEAAAQAAAUAAQAHAAAUAABE9ATMdAUABQEBAQEAAAAUAAAAAAMABwAADAAcADwATABcAADM1MxUnIzUzKwE9AjMdAT0BMxU9ATMVgEBAQEBAQEBAQEBAQEBAQEBAQIBAQEBAQAAAAAUAAAAAAMABwAADAAcADwATABcAADE1MxU9ATMVPQMzHQInIzUzKwE1M0BAQEBAQEBAQEBAQEBAQEBAQEBAQMBAQAAABQAAAQAAwAHAAAMABwALAA8AEwAAEzUzFSM1MxU3IzUzMTUzFSsBNTOAQMBAQEBAQIBAQAEAQEBAQEBAQEBAAAEAAABAAMABAAALAAA3NSM1MzUzFTMVIxVAQEBAQEBAQEBAQEBAAAABAAD/wABAAEAABQAAFT0BMx0BQEBAQEBAAAAAAQAAAIAAwADAAAcAADczFSsCNTOAQEBAQEDAQEAAAAABAAAAAABAAEAAAwAAMTUzFUBAQAAAAAADAAAAAADAAcAABQANABMAADE9ATMdAT0DMx0CPQIzHQFAQEBAQEBAgEBAQEBAQMBAQEBAAAAAAAIAAAAAAUABwAAXACMAADMrATUjPQQzNTsCFTMdBCMVJz0EIx0EwEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAABAAAAAADAAcAAEwAAMyM9BCM1MzU7AR0GgEBAQEBAQEBAQEBAQEBAQEBAQEAAAAABAAAAAAFAAcAAJQAAJTMVKwQ9AjM1OwE9ASMVKwE1MzU7AhUzHQEjFSsBHQEzAQBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAQAAAAABQAHAACUAADMrATUjNTsBFTM9ASM1Mz0BIxUrATUzNTsCFTMdASMVMx0BIxXAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAAABAAAAAAFAAcAAHwAAISM1KwI9BDsBHQMzPQQ7AR0GAQBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAAAAAEAAAAAAUABwAAnAAAzKwE1IzU7ARUzPQIjFSsBPQM7BBUrAhU7ARUzHQIjFcBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAAAAACAAAAAAFAAcAAHwAlAAAzKwE1Iz0EMzU7AhUzFSsBNSMdATsBFTMdASMVJz0BIx0BwEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAAAAAEAAAAAAUABwAAbAAAzIz0CMzUzPQErAjU7BB0CIxUjHQKAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAADAAAAAAFAAcAAGwAhACcAADMrATUjPQEzNSM9ATM1OwIVMx0BIxUzHQEjFSc9ASMdATc9ASMdAcBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEDAQEBAQAAAAgAAAAABQAHAAB8AJQAAMysBNSM1OwEVMz0BKwE1Iz0BMzU7AhUzHQQjFQM9ASMdAcBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEABAEBAQEAAAAACAAAAAABAAMAAAwAHAAAxNTMVJzUzFUBAQEBAgEBAAAIAAP/AAEAAwAAFAAkAABU9ATMdASc1MxVAQEBAQEBAQMBAQAAAAAADAAAAQACAAQAAAwAHAAsAADc1MxUnIzUzMTUzFUBAQEBAQEBAQEBAQEAAAAIAAABAAMABAAAHAA8AADczFSsCNTM3MxUrAjUzgEBAQEBAQEBAQEBAgEBAgEBAAAMAAABAAIABAAADAAcACwAAPQEzFT0BMxUnIzUzQEBAQEBAQEBAQEBAQAAAAgAAAAABQAHAAAMAGwAAMzUzFSc9ATM9ASMVKwE1MzU7AhUzHQEjFSMVgEBAQEBAQEBAQEBAQEBAQIBAQEBAQEBAQEBAQEAAAwAAAAABQAFAAA8AGQAjAAAzKwE1MzUzNTM1Mx0CIxUnIz0CMxUzFSM3IzUjNTsCFSPAQEBAQEBAQMBAQEBAgEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAAACAAAAAAFAAcAAGQAjAAAhIzUjFSsBPQUzNTsCFTMdBSc9AyMdAwEAQEBAQEBAQEBAgEBAQEBAQEBAQEBAQEBAQEBAgEBAQEBAQEBAAAAAAAMAAAAAAUABwAAZACEAJQAAMysCPQY7AxUzFSMVMx0CIxUnPQIjHQITNSMVwEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAEAQEAAAAABAAAAAAFAAcAAJQAAMysBNSM9BDM1OwIVMx0BKwE9ASMdBDM9ATsBHQEjFcBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAACAAAAAAFAAcAAFwAjAAAzKwI9BjsDFTMdBCMVJz0EIx0EwEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAABAAAAAAEAAcAAGwAANzMVKwM9BjsDFSsBHQIzFSMVwEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAAAAAAAQAAAAABAAHAABcAADMjPQY7AxUrAR0CMxUjHQFAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAAAAACAAAAAAFAAcAAIQAlAAAzKwE1Iz0EMzU7AhUzHQErAT0BIx0COwIdASMVJzUjFcBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAQAAAAABQAHAACMAACEjNSMVKwE9BjsBHQQzPQQ7AR0GAQBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAQAAAAABAAHAABkAADMrAjUzPQQjNTsDFSMdBDMVwEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAAAAAAAQAAAAABQAHAACEAADMrATUjPQE7AR0BMz0EKwI1OwQdBSMVwEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAQAAAAABQAHAACUAACEjNSMVKwE9BjsBHQQzPQQzFTMdAyMVMxUBAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAAAAABAAAAAAEAAcAAFQAANzMVKwM9BjsBHQXAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAABAAAAAAHAAcAAKQAANzUjHQMrAT0GOwEVMxUzNTM1OwEdBisBPQMjFcBAQEBAQEBAQEBAQEBAwEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAAAAAAAgAAAAABgAHAABMAJwAAISM1IzUzPQQ7AR0GISM9BjsBHQMzFSMdAQFAQEBAQED+wEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAgAAAAABQAHAABcAIwAAMysBNSM9BDM1OwIVMx0EIxUnPQQjHQTAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAIAAAAAAUABwAAXACEAADMjPQY7AxUzHQMjFSsBFTc9AyMdA0BAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAgEBAQEBAQEBAAAIAAP/AAUABwAAbACcAAAUjNSsBNSM9BDM1OwIVMx0EIxUzFSc9BCMdBAEAQEBAQEBAQEBAQECAQEBAQEBAQEBAQEBAQEBAQEBAgEBAQEBAQEBAQEAAAAACAAAAAAFAAcAAGwAlAAAhIzUjFSsBPQY7AxUzHQMjFTMVJz0DIx0DAQBAQEBAQEBAQEBAQIBAQEBAQEBAQEBAQEBAQEBAQIBAQEBAQEBAQAAAAAABAAAAAAFAAcAAJwAAMysBNSM1OwEVMz0BKwE1Iz0BMzU7AhUzFSsBNSMdATsBFTMdASMVwEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAAABAAAAAAEAAcAAFQAAMyM9BSM1OwMVIx0FgEBAQEBAQEBAQEBAQEBAQEBAQEBAQAABAAAAAAFAAcAAIwAAMysBNSM9BTsBHQUzPQU7AR0FIxXAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAAAAABAAAAAAFAAcAAIQAAMzUjNSM9BDsBHQQzPQQ7AR0EIxUjFYBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAAAAABAAAAAAHAAcAAKQAAITUjFSM1IzUjPQQ7AR0EMzUzFTM9BDsBHQQjFSMVAQBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAQAAAAABQAHAACcAACEjNSMVKwE1MzUjPQQ7AR0EMz0EOwEdBCMVMxUBAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAQAAAAABQAHAAB8AADM9ASM1Iz0DOwEdAzM9AzsBHQMjFSMdAYBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAAAAQAAAAABQAHAACcAACErAz0CMzU7AT0BIxUrAT0BOwQdAiMVKwEdATM1OwEdAQEAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAEAAAAAAIABwAATAAAzIz0GOwEVIx0EMxVAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAAMAAAAAAMABwAAFAA0AEwAAMz0BMx0BJyM9AjMdAScjPQEzFYBAQEBAQEBAQEBAQIBAQEBAQIBAQEAAAAEAAAAAAIABwAATAAAzIzUzPQQjNTsBHQZAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAAMAAAFAAMABwAADAAcACwAAEzUzFSM1MxU3IzUzgEDAQEBAQAFAQEBAQEBAAAAAAAEAAP+AAMD/wAAHAAAXMxUrAjUzgEBAQEBAQEBAAAAAAQAAAUAAQAHAAAUAABE9ATMdAUABQEBAQEAAAAIAAAAAAUABwAAZACMAACEjNSMVKwE9BTM1OwIVMx0FJz0DIx0DAQBAQEBAQEBAQECAQEBAQEBAQEBAQEBAQEBAQECAQEBAQEBAQEAAAAAAAwAAAAABQAHAABkAIQAlAAAzKwI9BjsDFTMVIxUzHQIjFSc9AiMdAhM1IxXAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAQBAQAAAAAEAAAAAAUABwAAlAAAzKwE1Iz0EMzU7AhUzHQErAT0BIx0EMz0BOwEdASMVwEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAAAAIAAAAAAUABwAAXACMAADMrAj0GOwMVMx0EIxUnPQQjHQTAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAEAAAAAAQABwAAbAAA3MxUrAz0GOwMVKwEdAjMVIxXAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAAABAAAAAAEAAcAAFwAAMyM9BjsDFSsBHQIzFSMdAUBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAAIAAAAAAUABwAAhACUAADMrATUjPQQzNTsCFTMdASsBPQEjHQI7Ah0BIxUnNSMVwEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAABAAAAAAFAAcAAIwAAISM1IxUrAT0GOwEdBDM9BDsBHQYBAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAABAAAAAAEAAcAAGQAAMysCNTM9BCM1OwMVIx0EMxXAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAAABAAAAAAFAAcAAIQAAMysBNSM9ATsBHQEzPQQrAjU7BB0FIxXAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAABAAAAAAFAAcAAJQAAISM1IxUrAT0GOwEdBDM9BDMVMx0DIxUzFQEAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAAEAAAAAAQABwAAVAAA3MxUrAz0GOwEdBcBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAEAAAAAAcABwAApAAA3NSMdAysBPQY7ARUzFTM1MzU7AR0GKwE9AyMVwEBAQEBAQEBAQEBAQEDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAAACAAAAAAGAAcAAEwAnAAAhIzUjNTM9BDsBHQYhIz0GOwEdAzMVIx0BAUBAQEBAQP7AQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAACAAAAAAFAAcAAFwAjAAAzKwE1Iz0EMzU7AhUzHQQjFSc9BCMdBMBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAAAgAAAAABQAHAABcAIQAAMyM9BjsDFTMdAyMVKwEVNz0DIx0DQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQECAQEBAQEBAQEAAAgAA/8ABQAHAABsAJwAABSM1KwE1Iz0EMzU7AhUzHQQjFTMVJz0EIx0EAQBAQEBAQEBAQEBAQIBAQEBAQEBAQEBAQEBAQEBAQECAQEBAQEBAQEBAQAAAAAIAAAAAAUABwAAbACUAACEjNSMVKwE9BjsDFTMdAyMVMxUnPQMjHQMBAEBAQEBAQEBAQEBAgEBAQEBAQEBAQEBAQEBAQEBAgEBAQEBAQEBAAAAAAAEAAAAAAUABwAAnAAAzKwE1IzU7ARUzPQErATUjPQEzNTsCFTMVKwE1Ix0BOwEVMx0BIxXAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAAAAAEAAAAAAQABwAAVAAAzIz0FIzU7AxUjHQWAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAEAAAAAAUABwAAjAAAzKwE1Iz0FOwEdBTM9BTsBHQUjFcBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAAEAAAAAAUABwAAhAAAzNSM1Iz0EOwEdBDM9BDsBHQQjFSMVgEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAAEAAAAAAcABwAApAAAhNSMVIzUjNSM9BDsBHQQzNTMVMz0EOwEdBCMVIxUBAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAABAAAAAAFAAcAAJwAAISM1IxUrATUzNSM9BDsBHQQzPQQ7AR0EIxUzFQEAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAABAAAAAAFAAcAAHwAAMz0BIzUjPQM7AR0DMz0DOwEdAyMVIx0BgEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAAAAABAAAAAAFAAcAAJwAAISsDPQIzNTsBPQEjFSsBPQE7BB0CIxUrAR0BMzU7AR0BAQBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAABQAAAAAAwAHAAAMACQANABMAFwAAMzUzFScjPQEzFScjNTMxPQEzHQE9ATMVgEBAQEBAQEBAQEBAQEBAQEBAQEBAQIBAQAAAAQAAAAAAQAHAAA8AADE9BjMdBkBAQEBAQEBAQEBAQEBAQAAABQAAAAAAwAHAAAMACQANABMAFwAAMTUzFT0CMx0BPQEzFScjPQEzFScjNTNAQEBAQEBAQEBAQEBAQEBAgEBAQEBAQEBAAAAABAAAAEABAADAAAMABwALAA8AADc1MxUjNTMVNzUzFSsBNTOAQMBAgECAQEBAQEBAQEBAQEAAAAACAAAAAABAAcAACwAPAAAxPQQzHQQDNTMVQEBAQEBAQEBAQEBAQAGAQEAAAAEAAAAAAUABwAAlAAAlMxUrBDUzNSM1MzUjPQEzNTsCFTMVKwE1Ix0BMxUzFSMVAQBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAACAAABgADAAcAAAwAHAAATNTMVIzUzFYBAwEABgEBAQEAAAAAEAAAAAAFAAUAACQARABsAJQAAMysBNTM1MxUzFT0DMx0CISM9AjMVMxUjNzUjNTsCFSMVwEBAQEBAQP8AQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAAAGAAAAQAEAAQAAAwAHAAsADwATABcAADc1MxUjNTMVNyM1MwcjNTsBNTMVKwE1M8BAwEBAQECAQECAQIBAQEBAQEBAQEBAQEBAQAAAAQAAAAABQAFAAB0AADMrATUjPQIzNTsCFSMdASMVMzUzPQEzHQIjFcBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAQAAAEAAwAFAABEAADcrATUzNSM1MzUzFTMVIxUzFYBAQEBAQEBAQEBAQEBAQEBAQEAAAAEAAAFAAEABwAAFAAARPQEzHQFAAUBAQEBAAAADAED/QAEAAAAABQAJAA0AABczFSsBNTM1MxUnIzUzgEBAQIBAQEBAgEBAQEBAQAAGAAAAQAEAAQAAAwAHAAsADwATABcAADc1MxUjNTMVNzUzFSsBNTsBIzUzByM1M4BAwECAQIBAQEBAQIBAQEBAQEBAQEBAQEBAQAAAAgAAAAABQAHAAAMAGwAAEzUzFRErATUjPQEzNTM1Mx0BIx0BMzU7ARUjFYBAQEBAQEBAQEBAQEABgEBA/oBAQEBAQEBAQEBAQEAAAAEAAAAAAUABgAAdAAAlMxUrAjUjNSM9ATM1MzU7AhUrARU7AR0BKwEVAQBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAAAAAAAA4ArgABAAAAAAAAAAYADgABAAAAAAABAAsALQABAAAAAAACAAYARwABAAAAAAADABIAdAABAAAAAAAEAAsAnwABAAAAAAAFABAAzQABAAAAAAAGAAsA9gADAAEECQAAAAwAAAADAAEECQABABYAFQADAAEECQACAAwAOQADAAEECQADACQATgADAAEECQAEABYAhwADAAEECQAFACAAqwADAAEECQAGABYA3gBMAGEAbgBhAFIAbwAATGFuYVJvAABQAGkAeABlAGwATQBpAGQAZABsAGUAAFBpeGVsTWlkZGxlAABNAGUAZABpAHUAbQAATWVkaXVtAABMAGEAbgBhAFIAbwA6AFAAaQB4AGUAbABNAGkAZABkAGwAZQAATGFuYVJvOlBpeGVsTWlkZGxlAABQAGkAeABlAGwATQBpAGQAZABsAGUAAFBpeGVsTWlkZGxlAABWAGUAcgBzAGkAbwBuACAAMAAwADEALgAwADAAMAAgAABWZXJzaW9uIDAwMS4wMDAgAABQAGkAeABlAGwATQBpAGQAZABsAGUAAFBpeGVsTWlkZGxlAAACAAAAAAAA/4AAMwAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAABAAIAAwAEAAUABgAHAAgACQAKAAsADAANAA4ADwAQABEAEgATABQAFQAWABcAGAAZABoAGwAcAB0AHgAfACAAIQAiACMAJAAlACYAJwAoACkAKgArACwALQAuAC8AMAAxADIAMwA0ADUANgA3ADgAOQA6ADsAPAA9AD4APwBAAEEAQgBDAEQARQBGAEcASABJAEoASwBMAE0ATgBPAFAAUQBSAFMAVABVAFYAVwBYAFkAWgBbAFwAXQBeAF8AYABhAQIAowCFAI4AiwCpAIoAkwCNAN4AqgCiAQMBBAd1bmkwMEEwBEV1cm8HdW5pMzAwMAAAAAAB//8AAAABAAAADgAAABgAIAAAAAIAAQABAG8AAQAEAAAAAgAAAAEAAAABAAAAAAABAAAAAMf+sN8AAAAAyHgrQQAAAADeMr7q") format('truetype');
    font-weight: normal;
    font-style: normal;
    font-display: swap;
  }
  @font-face {
    font-family: 'PixelSmall';
    src: url("data:font/ttf;base64,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") format('truetype');
    font-weight: normal;
    font-style: normal;
    font-display: swap;
  }
  /* EMBEDDED_FONTS_END */
</style>
</head>
<body>
<div class="game-frame">
  <canvas id="game-canvas" aria-label="Apfelhandel Spielbereich"></canvas>
</div>

<script>
(() => {
  "use strict";

  // ============================================================
  // SECTION 1: Canvas + Core Constants
  // ============================================================
  const canvas = document.getElementById("game-canvas");
  const ctx = canvas.getContext("2d");
  const VIEWPORT = { width: 900, height: 520 };
  const WORLD = { width: 3600, height: 2200 };
  const TEXT_SCALE = 2.0;
  const ROUND_DURATION_MS = 5 * 60 * 1000;
  const ROAD_RADIUS = 36;
  const PARK_RADIUS = 52;
  const COLORS = {
    bg: "#d4e9c6",
    fg: "#4a3b32",
    muted: "#8c7a6f",
    road: "#93a8c0",
    accent: "#e67e22",
    panel: "rgba(255, 250, 240, 0.95)",
    header: "#fdf2e9",
    border: "#4a3b32",
    farm: "#e6b0aa",
    market: "#f9e79f",
    store: "#aed6f1",
    factory: "#d5dbdb",
  };

  const SPRITE_MAP = {
    '.': null,
    'K': '#222222', // Black
    'W': '#ffffff', // White
    'R': '#e74c3c', // Red
    'G': '#2ecc71', // Green
    'B': '#5dade2', // Main Blue
    'L': '#85c1e9', // Highlight Blue
    'N': '#2e86c1', // Shadow Blue
    'Y': '#f1c40f', // Yellow
    'O': '#e67e22', // Orange
    'S': '#ecf0f1', // Silver
    'D': '#7f8c8d', // Grey
    'H': '#f5cba7', // Skin
    'M': '#5d4037', // Brown
    'P': '#d94336', // Premium Apple (red)
    'A': '#d9b441', // Normal Apple (gold)
    'C': '#6ca63f', // Cheap Apple (green)
    'E': '#27ae60', // Leaf
  };

  const SPRITES = {
    van: [
      ".....KKKKKK.....",
      "...KKNNNNNNKK...",
      "..KNNNNNNNNNNK..",
      ".KNNNNNNNNNNNNK.",
      ".KNNWWWWWWWWNNK.",
      "KNWWWWWWWWWWWWNK",
      "KNWWWWWWWWWWWWNK",
      "KBBBBBBBBBBBBBBK",
      "KBBLLLLLLLLLLBBK",
      "KBLLLLLLLLLLLLBK",
      "KBLLLLLLLLLLLLBK",
      "KBBLLLLLLLLLLBBK",
      "KBBBBBBBBBBBBBBK",
      "KBBBBBBBBBBBBBBK",
      "KBBBBBBBBBBBBBBK",
      ".KBBBBBBBBBBBBK.",
      ".KNNNNNNNNNNNNK.",
      "..KKRRNNNNSSKK..",
      "....KKKKKKKK....",
    ],
    simo: [
      "....HHHH....",
      "...HHHHHH...",
      "..HHHHHHHH..",
      "..HHHHHHHH..",
      "..HHKKKKHH..",
      "..HMMMMMHH..",
      "...HHHHHH...",
      "....HHHH....",
      "...MMMMMM...",
      "..MMMMMMMM..",
      "..MMMMMMMM..",
      "..MMMMMMMM..",
    ],
    lenny: [
      "...MMMMMM...",
      "..MMMMMMMM..",
      ".MMMMMMMMMM.",
      ".MMHHHHHHMM.",
      ".MMHHKKHMMMM.",
      ".MMHHHHHHMM.",
      "..MMMMMMMM..",
      "....HHHH....",
      "...BBBBBB...",
      "..BBBBBBBB..",
      "..BBBBBBBB..",
      "..BBBBBBBB..",
    ],
    julia: [
      "...MMMMMM...",
      "..MMMMMMMM..",
      ".MMMMMMMMMM.",
      ".MMHHHHHHMM.",
      ".MMHHKKHMMMM.",
      ".MMHHHHHHMM.",
      ".MMHHHHHHMM.",
      ".MMMMMMMMMM.",
      "...RRRRRR...",
      "..RRRRRRRR..",
      "..RRRRRRRR..",
      "..RRRRRRRR..",
    ],
    apple_premium: [
      ".....ME.....",
      "....MEE.....",
      "...KPPPK....",
      "..KPPPPPK...",
      ".KPPPPPPPK..",
      ".KPPPWPPPK..",
      ".KPPPPPPPK..",
      "..KPPPPPK...",
      "...KPPPK....",
      "....KKK.....",
    ],
    apple_normal: [
      ".....ME.....",
      "....MEE.....",
      "...KAAAK....",
      "..KAAAAAK...",
      ".KAAAAAAAK..",
      ".KAAAPAAAK..",
      ".KAAAAAAAK..",
      "..KAAAAAK...",
      "...KAAAK....",
      "....KKK.....",
    ],
    apple_cheap: [
      ".....ME.....",
      "....MEE.....",
      "...KCCCK....",
      "..KCCCCCK...",
      ".KCCCCCCCK..",
      ".KCCWCCCCK..",
      ".KCCCWKCCK..",
      "..KCCCCCK...",
      "...KCCCK....",
      "....KKK.....",
    ],
    tree: [
      "....GGGG....",
      "..GGGGGGGG..",
      ".GGGGGGGGGG.",
      "GGGPGGGAGGGG",
      "GGGGGGGGGGGG",
      "GGGAGGGPGGGG",
      ".GGGGGGGGGG.",
      "..GGGGGGGG..",
      "...GGGGGG...",
      "...MMMMMM...",
      "...MMMMMM...",
    ]
  };

  const EXTERNAL_ASSET_PATHS = {
    van: "assets/images/no-bg/Vehicle (The Van).png",
    tree_1_mega: "assets/images/no-bg/Tree_1_mega.png",
    tree_2_normal: "assets/images/no-bg/Tree_2_normal.png",
    tree_3_normal: "assets/images/no-bg/Tree_3_normal.png",
    tree_4_normal: "assets/images/no-bg/Tree_4_normal.png",
    tree_5_tini: "assets/images/no-bg/Tree_5_tini.png",
    tree_6_tini: "assets/images/no-bg/Tree_6_tini.png",
    tree_7_small: "assets/images/no-bg/Tree_7_small.png",
    tree_8_medium: "assets/images/no-bg/Tree_8_medium.png",
    farmBuilding: "assets/images/no-bg/Red Barn (Bauernhof).png",
    marketBuilding: "assets/images/no-bg/Market Stalls (Markt).png",
    storeBuilding: "assets/images/no-bg/Supermarket.png",
    factoryBuilding: "assets/images/no-bg/Factory (Fabrik).png",
    char_lenny: "assets/images/no-bg/Lenny.png",
    char_julia: "assets/images/no-bg/Julia.png",
    char_simo: "assets/images/no-bg/Simo.png",
    apple_premium: "assets/images/no-bg/Perfect red apple.png",
    apple_normal: "assets/images/no-bg/Golden apple.png",
    apple_cheap: "assets/images/no-bg/Rotton Apple.png",
  };
  const TREE_VARIANT_PROFILES = [
    { assetId: "tree_1_mega", sizeMul: 1.75, anchorY: 0.82, weight: 0.6 },
    { assetId: "tree_2_normal", sizeMul: 1.0, anchorY: 0.82, weight: 1.35 },
    { assetId: "tree_3_normal", sizeMul: 0.98, anchorY: 0.82, weight: 1.25 },
    { assetId: "tree_4_normal", sizeMul: 0.96, anchorY: 0.82, weight: 1.2 },
    { assetId: "tree_5_tini", sizeMul: 0.28, anchorY: 0.84, weight: 1.0 },
    { assetId: "tree_6_tini", sizeMul: 0.24, anchorY: 0.84, weight: 1.0 },
    { assetId: "tree_7_small", sizeMul: 0.55, anchorY: 0.82, weight: 1.0 },
    { assetId: "tree_8_medium", sizeMul: 0.74, anchorY: 0.82, weight: 1.1 },
  ];
  const TREE_VARIANT_POOL = [];
  for (const profile of TREE_VARIANT_PROFILES) {
    const repeats = Math.max(1, Math.round(profile.weight * 10));
    for (let i = 0; i < repeats; i += 1) TREE_VARIANT_POOL.push(profile);
  }
  const artAssets = {
    images: {},
    bounds: {},
    total: Object.keys(EXTERNAL_ASSET_PATHS).length,
    loaded: 0,
    failed: 0,
  };

  canvas.width = VIEWPORT.width;
  canvas.height = VIEWPORT.height;

  // ============================================================
  // SECTION 2: Economy + Domain Data
  // ============================================================
  const APPLES = [
    { id: "premium", name: "Premium Apfel", buyPrice: 5.0 },
    { id: "normal", name: "Apfel", buyPrice: 2.0 },
    { id: "cheap", name: "Billiger Apfel", buyPrice: 0.5 },
  ];

  const CHARACTERS = [
    { id: "lenny", name: "Lenny", speed: "high", negotiation: "low", care: "medium", startCash: 25 },
    { id: "julia", name: "Julia", speed: "low", negotiation: "medium", care: "high", startCash: 20 },
    { id: "simo", name: "Simo", speed: "medium", negotiation: "high", care: "low", startCash: 15 },
  ];

  const CAPACITY_BY_CARE = { low: 12, medium: 22, high: 30 };
  const SPEED_BY_TRAIT = { low: 0.8, medium: 1.0, high: 1.55 };
  const SELL_PRICE = {
    market: { low: 6.0, medium: 7.0, high: 8.0 },
    store: { low: 3.0, medium: 5.0, high: 5.5 },
    factory: { low: 1.0, medium: 1.5, high: 2.0 },
  };

  const PLACES = {
    farm: { id: "farm", name: "Bauernhof", accepts: ["premium", "normal", "cheap"] },
    market: { id: "market", name: "Markt", accepts: ["premium", "normal"] },
    store: { id: "store", name: "Supermarkt", accepts: ["premium", "normal", "cheap"] },
    factory: {
      id: "factory",
      name: "Apfelmussfabrik Kaiserschmarrn",
      graphicLabel: "Kaiserschmarrn",
      accepts: ["premium", "normal", "cheap"],
    },
  };

  // ============================================================
  // SECTION 3: World Layout (nodes, parks, roads)
  // ============================================================
  const nodes = {
    farm: { x: 380, y: 1280 },
    market: { x: 2760, y: 720 },
    store: { x: 2980, y: 980 },
    factory: { x: 3380, y: 1500 },
  };

  const parks = {
    farm: { x: nodes.farm.x + 150, y: nodes.farm.y + 40, r: PARK_RADIUS },
    market: { x: nodes.market.x - 130, y: nodes.market.y + 120, r: PARK_RADIUS },
    store: { x: nodes.store.x - 120, y: nodes.store.y + 150, r: PARK_RADIUS },
    factory: { x: nodes.factory.x - 140, y: nodes.factory.y + 180, r: PARK_RADIUS },
  };
  const PLACE_ART = {
    farm: { assetId: "farmBuilding", width: 390, height: 334, anchorY: 0.8, entryX: 7, entryY: 28, labelOffsetY: 78 },
    market: { assetId: "marketBuilding", width: 420, height: 273, anchorY: 0.8, entryX: -27, entryY: 39, labelOffsetY: 81 },
    store: { assetId: "storeBuilding", width: 383, height: 278, anchorY: 0.8, entryX: 0, entryY: 48, labelOffsetY: 81, drawOffsetX: 90 },
    factory: {
      assetId: "factoryBuilding",
      width: 360,
      height: 300,
      anchorY: 0.82,
      fit: "cover",
      entryX: -24,
      entryY: 56,
      labelOffsetY: 88,
      smokeX: -66,
      smokeY: -144,
    },
  };

  const roads = [];

  // ============================================================
  // SECTION 4: Utility Helpers
  // ============================================================
  const clamp = (v, min, max) => Math.max(min, Math.min(max, v));
  const random = (min, max) => min + Math.random() * (max - min);
  const randomInt = (min, max) => Math.floor(random(min, max + 1));
  const lerp = (a, b, t) => a + (b - a) * t;
  const invCount = (inv) => inv.premium + inv.normal + inv.cheap;
  const formatCHF = (value) => `${value.toFixed(2)} CHF`;
  const hash2D = (x, y, seed = 0) => {
    const v = Math.sin((x * 127.1) + (y * 311.7) + (seed * 73.7)) * 43758.5453123;
    return v - Math.floor(v);
  };
  const appleAssetId = (appleId) => `apple_${appleId}`;
  const characterAssetId = (characterId) => `char_${characterId}`;
  const HUD_CHARACTER_FALLBACK_BOUNDS = {
    char_lenny: { sx: 761 / 1920, sy: 1 / 1080, sw: 395 / 1920, sh: 1079 / 1080 },
    char_julia: { sx: 702 / 1920, sy: 0 / 1080, sw: 511 / 1920, sh: 1079 / 1080 },
    char_simo: { sx: 693 / 1920, sy: 11 / 1080, sw: 534 / 1920, sh: 1051 / 1080 },
  };

  function toAssetUrl(relativePath) {
    try {
      return new URL(relativePath, window.location.href).href;
    } catch (_) {
      return encodeURI(relativePath);
    }
  }

  function computeOpaqueBounds(image) {
    const w = image.naturalWidth || image.width;
    const h = image.naturalHeight || image.height;
    if (!w || !h) return { sx: 0, sy: 0, sw: 1, sh: 1 };

    const offscreen = document.createElement("canvas");
    offscreen.width = w;
    offscreen.height = h;
    const offCtx = offscreen.getContext("2d", { willReadFrequently: true });
    if (!offCtx) return { sx: 0, sy: 0, sw: w, sh: h };
    offCtx.drawImage(image, 0, 0, w, h);
    const data = offCtx.getImageData(0, 0, w, h).data;

    let minX = w;
    let minY = h;
    let maxX = -1;
    let maxY = -1;
    for (let y = 0; y < h; y += 1) {
      for (let x = 0; x < w; x += 1) {
        const alpha = data[(y * w + x) * 4 + 3];
        if (alpha === 0) continue;
        if (x < minX) minX = x;
        if (y < minY) minY = y;
        if (x > maxX) maxX = x;
        if (y > maxY) maxY = y;
      }
    }

    if (maxX < minX || maxY < minY) return { sx: 0, sy: 0, sw: w, sh: h };
    return { sx: minX, sy: minY, sw: maxX - minX + 1, sh: maxY - minY + 1 };
  }

  function boundsFromNormalized(image, normalized) {
    if (!image || !normalized) return null;
    const iw = image.naturalWidth || image.width || 0;
    const ih = image.naturalHeight || image.height || 0;
    if (!iw || !ih) return null;
    return {
      sx: Math.round(iw * normalized.sx),
      sy: Math.round(ih * normalized.sy),
      sw: Math.max(1, Math.round(iw * normalized.sw)),
      sh: Math.max(1, Math.round(ih * normalized.sh)),
    };
  }

  function clampBoundsToImage(image, bounds) {
    if (!image || !bounds) return null;
    const iw = image.naturalWidth || image.width || 0;
    const ih = image.naturalHeight || image.height || 0;
    if (!iw || !ih) return null;

    const sx = clamp(Math.round(bounds.sx), 0, Math.max(0, iw - 1));
    const sy = clamp(Math.round(bounds.sy), 0, Math.max(0, ih - 1));
    const maxW = Math.max(1, iw - sx);
    const maxH = Math.max(1, ih - sy);
    const sw = clamp(Math.round(bounds.sw), 1, maxW);
    const sh = clamp(Math.round(bounds.sh), 1, maxH);
    return { sx, sy, sw, sh };
  }

  function resolveHudCharacterSourceBounds(assetId) {
    const image = artAssets.images[assetId];
    if (!image || !image.naturalWidth || !image.naturalHeight) return null;

    const autoBounds = artAssets.bounds[assetId];
    const fallbackBounds = boundsFromNormalized(image, HUD_CHARACTER_FALLBACK_BOUNDS[assetId]);
    const defaultBounds = {
      sx: Math.round(image.naturalWidth * 0.34),
      sy: 0,
      sw: Math.max(1, Math.round(image.naturalWidth * 0.32)),
      sh: image.naturalHeight,
    };
    const baseBounds = autoBounds || fallbackBounds || defaultBounds;

    // HUD should show the upper half (head + torso) from wide source images.
    const cropXRatio = 0.9;
    const cropYRatio = 0.52;
    const focusY = 0.26;
    const cropW = Math.max(1, Math.round(baseBounds.sw * cropXRatio));
    const cropH = Math.max(1, Math.round(baseBounds.sh * cropYRatio));
    const centerX = baseBounds.sx + baseBounds.sw * 0.5;
    const centerY = baseBounds.sy + baseBounds.sh * focusY;
    const cropped = {
      sx: Math.round(centerX - cropW * 0.5),
      sy: Math.round(centerY - cropH * 0.5),
      sw: cropW,
      sh: cropH,
    };
    return clampBoundsToImage(image, cropped);
  }

  function preloadArtAssets() {
    for (const [assetId, relativePath] of Object.entries(EXTERNAL_ASSET_PATHS)) {
      const image = new Image();
      artAssets.images[assetId] = image;
      image.onload = () => {
        const bounds = computeOpaqueBounds(image);
        artAssets.bounds[assetId] = bounds;
        artAssets.loaded += 1;
      };
      image.onerror = () => {
        artAssets.failed += 1;
      };
      image.src = toAssetUrl(relativePath);
    }
  }

  function distancePointToSegment(px, py, ax, ay, bx, by) {
    const abx = bx - ax;
    const aby = by - ay;
    const apx = px - ax;
    const apy = py - ay;
    const ab2 = abx * abx + aby * aby || 1;
    const t = clamp((apx * abx + apy * aby) / ab2, 0, 1);
    const cx = ax + t * abx;
    const cy = ay + t * aby;
    const dx = px - cx;
    const dy = py - cy;
    return { d: Math.hypot(dx, dy), t, cx, cy };
  }

  function catmullRom(p0, p1, p2, p3, t) {
    const t2 = t * t;
    const t3 = t2 * t;
    return {
      x: 0.5 * ((2 * p1.x) + (-p0.x + p2.x) * t + (2 * p0.x - 5 * p1.x + 4 * p2.x - p3.x) * t2 + (-p0.x + 3 * p1.x - 3 * p2.x + p3.x) * t3),
      y: 0.5 * ((2 * p1.y) + (-p0.y + p2.y) * t + (2 * p0.y - 5 * p1.y + 4 * p2.y - p3.y) * t2 + (-p0.y + 3 * p1.y - 3 * p2.y + p3.y) * t3),
    };
  }

  function smoothPath(controlPoints, samplesPerSegment = 16) {
    if (controlPoints.length < 2) return controlPoints.slice();
    const padded = [controlPoints[0], ...controlPoints, controlPoints[controlPoints.length - 1]];
    const sampled = [];
    for (let i = 0; i < padded.length - 3; i += 1) {
      const p0 = padded[i];
      const p1 = padded[i + 1];
      const p2 = padded[i + 2];
      const p3 = padded[i + 3];
      for (let s = 0; s < samplesPerSegment; s += 1) {
        sampled.push(catmullRom(p0, p1, p2, p3, s / samplesPerSegment));
      }
    }
    sampled.push(controlPoints[controlPoints.length - 1]);
    return sampled;
  }

  function addRoad(controlPoints, smooth = true) {
    roads.push(smooth ? smoothPath(controlPoints) : controlPoints.slice());
  }

  // ============================================================
  // SECTION 5: Demand/Supply + Road Generation
  // ============================================================
  function farmSupply() {
    return {
      premium: randomInt(0, 10),
      normal: randomInt(6, 22),
      cheap: randomInt(0, 30),
    };
  }

  function demandFor(placeId) {
    const demand = { premium: 0, normal: 0, cheap: 0 };
    if (placeId === "market") {
      demand.premium = randomInt(6, 16);
      demand.normal = randomInt(3, 6);
    } else if (placeId === "store") {
      demand.premium = randomInt(1, 7);
      demand.normal = randomInt(7, 18);
      demand.cheap = randomInt(0, 4);
    } else {
      demand.premium = randomInt(0, 3);
      demand.normal = randomInt(2, 10);
      demand.cheap = randomInt(10, 26);
    }

    for (const key of Object.keys(demand)) {
      if (!PLACES[placeId].accepts.includes(key)) demand[key] = 0;
    }
    return demand;
  }

  function forceParkConnections() {
    for (const park of Object.values(parks)) {
      let best = { d: Infinity, roadIndex: -1, segmentIndex: -1, cx: park.x, cy: park.y };
      for (let roadIndex = 0; roadIndex < roads.length; roadIndex += 1) {
        const road = roads[roadIndex];
        for (let i = 0; i < road.length - 1; i += 1) {
          const a = road[i];
          const b = road[i + 1];
          const closest = distancePointToSegment(park.x, park.y, a.x, a.y, b.x, b.y);
          if (closest.d < best.d) {
            best = { d: closest.d, roadIndex, segmentIndex: i, cx: closest.cx, cy: closest.cy };
          }
        }
      }

      if (best.roadIndex >= 0) {
        const baseRoad = roads[best.roadIndex];
        baseRoad.splice(best.segmentIndex + 1, 0, { x: best.cx, y: best.cy });
      }

      addRoad(
        [
          { x: park.x, y: park.y },
          { x: park.x * 0.6 + best.cx * 0.4, y: park.y * 0.6 + best.cy * 0.4 },
          { x: best.cx, y: best.cy },
        ],
        true
      );

      addRoad(
        [
          { x: park.x - 1, y: park.y - 1 },
          { x: park.x + 1, y: park.y + 1 },
        ],
        false
      );
    }
  }

  function buildRoadNetwork() {
    roads.length = 0;

    addRoad([
      { x: parks.farm.x, y: parks.farm.y },
      { x: 640, y: 1180 },
      { x: 980, y: 980 },
      { x: 1360, y: 820 },
      { x: 1760, y: 760 },
      { x: 2140, y: 790 },
      { x: 2500, y: 880 },
      { x: 2760, y: 930 },
      { x: parks.store.x, y: parks.store.y },
    ]);

    addRoad([
      { x: parks.store.x, y: parks.store.y },
      { x: 2860, y: 860 },
      { x: parks.market.x, y: parks.market.y },
    ]);

    addRoad([
      { x: parks.store.x, y: parks.store.y },
      { x: 3160, y: 1160 },
      { x: 3230, y: 1380 },
      { x: 3130, y: 1550 },
      { x: parks.factory.x, y: parks.factory.y },
    ]);

    addRoad([
      { x: parks.farm.x, y: parks.farm.y },
      { x: 760, y: 1560 },
      { x: 1120, y: 1780 },
      { x: 1580, y: 1940 },
      { x: 2060, y: 1860 },
      { x: 2480, y: 1760 },
      { x: 2800, y: 1700 },
      { x: parks.factory.x, y: parks.factory.y },
    ]);

    addRoad([{ x: 1700, y: 780 }, { x: 1500, y: 980 }, { x: 1540, y: 1240 }, { x: 1700, y: 1440 }], true);
    addRoad([{ x: 2460, y: 920 }, { x: 2300, y: 1080 }, { x: 2120, y: 1200 }], true);
    addRoad([{ x: 3000, y: 980 }, { x: 3200, y: 940 }, { x: 3360, y: 860 }], true);

    forceParkConnections();
  }

  // ============================================================
  // SECTION 6: State Model
  // ============================================================
  const camera = { x: 0, y: 0, targetX: 0, targetY: 0 };

  const player = {
    x: parks.farm.x,
    y: parks.farm.y,
    vx: 0,
    vy: 0,
    rotation: 0,
    character: CHARACTERS[0],
    speedMultiplier: 1,
    capacity: 0,
    cash: 0,
    inventory: { premium: 0, normal: 0, cheap: 0 },
  };

  const state = {
    mode: "title",
    timeLeftMs: ROUND_DURATION_MS,
    selectedCharacterIndex: 0,
    modal: null,
    listSelection: 0,
    cart: { premium: 0, normal: 0, cheap: 0 },
    needs: {
      market: demandFor("market"),
      store: demandFor("store"),
      factory: demandFor("factory"),
    },
    keys: new Set(),
  };

  buildRoadNetwork();
  preloadArtAssets();

  // ============================================================
  // SECTION 7: Spatial Queries + Camera
  // ============================================================
  function worldToScreen(x, y) {
    return { x: x - camera.x, y: y - camera.y };
  }

  function updateCamera(dt) {
    camera.targetX = clamp(player.x - VIEWPORT.width / 2, 0, WORLD.width - VIEWPORT.width);
    camera.targetY = clamp(player.y - VIEWPORT.height / 2, 0, WORLD.height - VIEWPORT.height);
    const blend = 1 - Math.pow(0.001, dt);
    camera.x += (camera.targetX - camera.x) * blend;
    camera.y += (camera.targetY - camera.y) * blend;
  }

  function isOnRoad(x, y) {
    for (const park of Object.values(parks)) {
      const dx = x - park.x;
      const dy = y - park.y;
      if (dx * dx + dy * dy <= park.r * park.r) return true;
    }
    for (const road of roads) {
      for (let i = 0; i < road.length - 1; i += 1) {
        const a = road[i];
        const b = road[i + 1];
        if (distancePointToSegment(x, y, a.x, a.y, b.x, b.y).d <= ROAD_RADIUS) return true;
      }
    }
    return false;
  }

  function parkAt(x, y) {
    for (const [id, park] of Object.entries(parks)) {
      const dx = x - park.x;
      const dy = y - park.y;
      if (dx * dx + dy * dy <= park.r * park.r) return id;
    }
    return null;
  }

  // ============================================================
  // SECTION 8: Game Actions (start, modal, trade)
  // ============================================================
  function closeModal() {
    state.modal = null;
    state.listSelection = 0;
    state.cart = { premium: 0, normal: 0, cheap: 0 };
  }

  function startGame(character) {
    player.character = character;
    player.speedMultiplier = SPEED_BY_TRAIT[character.speed];
    player.capacity = CAPACITY_BY_CARE[character.care];
    player.cash = character.startCash;
    player.inventory = { premium: 0, normal: 0, cheap: 0 };
    player.x = parks.farm.x;
    player.y = parks.farm.y;
    player.vx = 0;
    player.vy = 0;

    state.mode = "play";
    state.timeLeftMs = ROUND_DURATION_MS;
    state.needs.market = demandFor("market");
    state.needs.store = demandFor("store");
    state.needs.factory = demandFor("factory");
    closeModal();
  }

  function openPauseModal() {
    state.modal = { type: "pause" };
    state.listSelection = 0;
  }

  function openBuyModal() {
    state.modal = { type: "buy", placeId: "farm", supply: farmSupply() };
    state.listSelection = 0;
    state.cart = { premium: 0, normal: 0, cheap: 0 };
  }

  function openSellModal(placeId) {
    const negotiation = player.character.negotiation;
    state.modal = {
      type: "sell",
      placeId,
      demand: { ...state.needs[placeId] },
      pricePerApple: SELL_PRICE[placeId][negotiation],
    };
    state.listSelection = 0;
    state.cart = { premium: 0, normal: 0, cheap: 0 };
  }

  function modalRows(modal) {
    if (!modal) return [];
    if (modal.type === "buy") {
      return APPLES.map((apple) => ({
        id: apple.id,
        label: apple.name,
        left: `Preis: ${formatCHF(apple.buyPrice)}`,
        right: `Angebot: ${modal.supply[apple.id]}`,
      }));
    }
    if (modal.type === "sell") {
      return APPLES.filter((apple) => PLACES[modal.placeId].accepts.includes(apple.id)).map((apple) => ({
        id: apple.id,
        label: apple.name,
        left: `Preis: ${formatCHF(modal.pricePerApple)}`,
        right: `Bedarf: ${modal.demand[apple.id]}`,
        extra: `Geladen: ${player.inventory[apple.id]}`,
      }));
    }
    return [];
  }

  function cartTotal() {
    return state.cart.premium + state.cart.normal + state.cart.cheap;
  }

  function cartCost() {
    let sum = 0;
    for (const apple of APPLES) sum += (state.cart[apple.id] || 0) * apple.buyPrice;
    return sum;
  }

  function maxAdjustFor(appleId) {
    const modal = state.modal;
    if (!modal) return 0;
    if (modal.type === "buy") {
      const apple = APPLES.find((entry) => entry.id === appleId);
      const supply = modal.supply[appleId];
      const plannedUnits = cartTotal();
      const capacityLeft = Math.max(0, player.capacity - invCount(player.inventory) - plannedUnits + (state.cart[appleId] || 0));
      const otherCost = cartCost() - (state.cart[appleId] || 0) * apple.buyPrice;
      const cashLeft = Math.max(0, player.cash - otherCost);
      const affordableByCash = Math.floor(cashLeft / apple.buyPrice);
      return Math.max(0, Math.min(supply, capacityLeft, affordableByCash));
    }
    if (modal.type === "sell") {
      return Math.max(0, Math.min(modal.demand[appleId] || 0, player.inventory[appleId] || 0));
    }
    return 0;
  }

  function adjustCart(appleId, delta) {
    const current = state.cart[appleId] || 0;
    if (delta < 0) {
      state.cart[appleId] = Math.max(0, current - 1);
      return;
    }
    state.cart[appleId] = clamp(current + 1, 0, maxAdjustFor(appleId));
  }

  function confirmTrade() {
    const modal = state.modal;
    if (!modal) return;

    if (modal.type === "buy") {
      for (const apple of APPLES) {
        const quantity = state.cart[apple.id] || 0;
        if (quantity <= 0) continue;
        const cost = quantity * apple.buyPrice;
        if (player.cash + 1e-9 < cost) continue;
        if (invCount(player.inventory) + quantity > player.capacity) continue;
        if (modal.supply[apple.id] < quantity) continue;
        player.cash -= cost;
        player.inventory[apple.id] += quantity;
        modal.supply[apple.id] -= quantity;
      }
      closeModal();
      return;
    }

    if (modal.type === "sell") {
      for (const apple of APPLES) {
        const requested = state.cart[apple.id] || 0;
        if (requested <= 0) continue;
        const possible = Math.min(requested, player.inventory[apple.id], modal.demand[apple.id] || 0);
        if (possible <= 0) continue;
        player.inventory[apple.id] -= possible;
        player.cash += possible * modal.pricePerApple;
        modal.demand[apple.id] -= possible;
      }
      state.needs[modal.placeId] = demandFor(modal.placeId);
      closeModal();
    }
  }

  // ============================================================
  // SECTION 9: Input + Movement
  // ============================================================
  function getInputDirection() {
    const keys = state.keys;
    const left = keys.has("ArrowLeft") || keys.has("a") || keys.has("A");
    const right = keys.has("ArrowRight") || keys.has("d") || keys.has("D");
    const up = keys.has("ArrowUp") || keys.has("w") || keys.has("W");
    const down = keys.has("ArrowDown") || keys.has("s") || keys.has("S");
    const dx = (right ? 1 : 0) + (left ? -1 : 0);
    const dy = (down ? 1 : 0) + (up ? -1 : 0);
    const length = Math.hypot(dx, dy) || 1;
    return { dx: dx / length, dy: dy / length };
  }

  function movePlayer(dt) {
    const direction = getInputDirection();
    const baseSpeed = 280;
    const smoothing = 10;
    const targetVx = direction.dx * baseSpeed * player.speedMultiplier;
    const targetVy = direction.dy * baseSpeed * player.speedMultiplier;

    player.vx += (targetVx - player.vx) * clamp(smoothing * dt, 0, 1);
    player.vy += (targetVy - player.vy) * clamp(smoothing * dt, 0, 1);

    if (Math.hypot(player.vx, player.vy) > 10) {
      player.rotation = Math.atan2(player.vy, player.vx) + Math.PI / 2;
    }

    const nextX = player.x + player.vx * dt;
    const nextY = player.y + player.vy * dt;

    if (isOnRoad(nextX, nextY)) {
      player.x = nextX;
      player.y = nextY;
    } else {
      if (isOnRoad(nextX, player.y)) player.x = nextX;
      if (isOnRoad(player.x, nextY)) player.y = nextY;
      player.vx *= 0.55;
      player.vy *= 0.55;
    }

    player.x = clamp(player.x, 0, WORLD.width);
    player.y = clamp(player.y, 0, WORLD.height);
  }

  function toggleFullscreen() {
    if (!document.fullscreenElement) {
      document.documentElement.requestFullscreen().catch(() => {});
    } else {
      document.exitFullscreen().catch(() => {});
    }
  }

  function onKeyDown(event) {
    if (["ArrowUp", "ArrowDown", "ArrowLeft", "ArrowRight", " ", "Enter", "Escape", "f", "F"].includes(event.key)) {
      event.preventDefault();
    }
    state.keys.add(event.key);

    if (event.key === "f" || event.key === "F") {
      toggleFullscreen();
      return;
    }

    if (state.mode === "title") {
      if (event.key === "ArrowLeft" || event.key === "ArrowUp") {
        state.selectedCharacterIndex = (state.selectedCharacterIndex + CHARACTERS.length - 1) % CHARACTERS.length;
      }
      if (event.key === "ArrowRight" || event.key === "ArrowDown") {
        state.selectedCharacterIndex = (state.selectedCharacterIndex + 1) % CHARACTERS.length;
      }
      if (event.key === "Enter") startGame(CHARACTERS[state.selectedCharacterIndex]);
      return;
    }

    if (state.modal) {
      if (event.key === "Escape") {
        closeModal();
        return;
      }

      if (state.modal.type === "pause") {
        if (event.key === "ArrowUp" || event.key === "ArrowDown") state.listSelection = (state.listSelection + 1) % 2;
        if (event.key === "Enter") {
          if (state.listSelection === 0) closeModal();
          else location.reload();
        }
        return;
      }

      const rows = modalRows(state.modal);
      if (rows.length === 0) return;
      if (event.key === "ArrowUp") state.listSelection = (state.listSelection + rows.length - 1) % rows.length;
      if (event.key === "ArrowDown") state.listSelection = (state.listSelection + 1) % rows.length;
      if (event.key === "ArrowLeft") adjustCart(rows[state.listSelection].id, -1);
      if (event.key === "ArrowRight") adjustCart(rows[state.listSelection].id, 1);
      if (event.key === "Enter") confirmTrade();
      return;
    }

    if (event.key === "Escape") {
      openPauseModal();
      return;
    }

    if (event.key === "Enter") {
      const activePark = parkAt(player.x, player.y);
      if (activePark === "farm") openBuyModal();
      if (activePark === "market" || activePark === "store" || activePark === "factory") openSellModal(activePark);
    }
  }

  function onKeyUp(event) {
    state.keys.delete(event.key);
  }

  addEventListener("keydown", onKeyDown);
  addEventListener("keyup", onKeyUp);

  // ============================================================
  // SECTION 10: Render Primitives
  // ============================================================
  function clearCanvas() {
    ctx.fillStyle = COLORS.bg;
    ctx.fillRect(0, 0, VIEWPORT.width, VIEWPORT.height);
  }

  function drawPixelSprite(spriteName, x, y, pixelSize = 2, rotation = 0) {
    const sprite = SPRITES[spriteName];
    if (!sprite) return;
    const rows = sprite.length;
    const cols = sprite[0].length;
    
    ctx.save();
    ctx.translate(x, y);
    ctx.rotate(rotation);
    ctx.translate(-cols * pixelSize / 2, -rows * pixelSize / 2);

    for (let r = 0; r < rows; r++) {
      for (let c = 0; c < cols; c++) {
        const char = sprite[r][c];
        const color = SPRITE_MAP[char];
        if (color) {
          ctx.fillStyle = color;
          ctx.fillRect(c * pixelSize, r * pixelSize, pixelSize, pixelSize);
        }
      }
    }
    ctx.restore();
  }

  function drawAsset(assetId, x, y, targetWidth, targetHeight, options = {}) {
    const image = artAssets.images[assetId];
    if (!image || !image.complete || !image.naturalWidth || !image.naturalHeight) return false;

    const bounds = options.sourceBounds || artAssets.bounds[assetId] || {
      sx: 0,
      sy: 0,
      sw: image.naturalWidth,
      sh: image.naturalHeight,
    };

    const fit = options.fit || "contain";
    const anchorX = options.anchorX ?? 0.5;
    const anchorY = options.anchorY ?? 0.5;
    const rotation = options.rotation || 0;
    const flipX = !!options.flipX;

    let drawWidth = targetWidth;
    let drawHeight = targetHeight;
    const srcRatio = bounds.sw / Math.max(1, bounds.sh);
    const dstRatio = targetWidth / Math.max(1, targetHeight);

    if (fit === "cover") {
      if (srcRatio > dstRatio) {
        drawHeight = targetHeight;
        drawWidth = targetHeight * srcRatio;
      } else {
        drawWidth = targetWidth;
        drawHeight = targetWidth / Math.max(0.0001, srcRatio);
      }
    } else if (srcRatio > dstRatio) {
      drawHeight = targetWidth / Math.max(0.0001, srcRatio);
    } else {
      drawWidth = targetHeight * srcRatio;
    }

    ctx.save();
    ctx.translate(x, y);
    ctx.rotate(rotation);
    if (flipX) ctx.scale(-1, 1);
    ctx.drawImage(
      image,
      bounds.sx,
      bounds.sy,
      bounds.sw,
      bounds.sh,
      -drawWidth * anchorX,
      -drawHeight * anchorY,
      drawWidth,
      drawHeight
    );
    ctx.restore();
    return true;
  }

  function drawWorldTree(x, y, scale = 1, variantSeed = 0.5, tiltSeed = 0.5) {
    const variantCount = TREE_VARIANT_POOL.length || TREE_VARIANT_PROFILES.length;
    const variantIndex = Math.min(variantCount - 1, Math.floor(variantSeed * variantCount));
    const profile = TREE_VARIANT_POOL[variantIndex] || TREE_VARIANT_PROFILES[0];
    const sizeJitter = 0.9 + variantSeed * 0.2;
    const rotation = (tiltSeed - 0.5) * 0.14;
    const drawScale = scale * profile.sizeMul * sizeJitter * 2;
    const drawn = drawAsset(profile.assetId, x, y, 58 * drawScale, 54 * drawScale, {
      anchorX: 0.5,
      anchorY: profile.anchorY ?? 0.82,
      rotation,
    });
    if (!drawn) drawPixelSprite("tree", x, y, 2.4 * drawScale, 0);
  }

  function estimateAssetContainHeight(assetId, targetWidth, targetHeight) {
    const bounds = artAssets.bounds[assetId];
    if (!bounds) return targetHeight;
    const srcRatio = bounds.sw / Math.max(1, bounds.sh);
    const dstRatio = targetWidth / Math.max(1, targetHeight);
    if (srcRatio > dstRatio) return targetWidth / Math.max(0.0001, srcRatio);
    return targetHeight;
  }

  function drawTreeLayer() {
    const treeQueue = [];
    const nearRoadOrPark = (x, y) => {
      for (const park of Object.values(parks)) {
        if (Math.hypot(x - park.x, y - park.y) < park.r + 42) return true;
      }
      for (const road of roads) {
        for (let i = 0; i < road.length - 1; i += 1) {
          const a = road[i];
          const b = road[i + 1];
          if (distancePointToSegment(x, y, a.x, a.y, b.x, b.y).d < ROAD_RADIUS + 34) return true;
        }
      }
      return false;
    };

    const nearBuilding = (x, y) => {
      for (const [id, node] of Object.entries(nodes)) {
        const art = PLACE_ART[id] || PLACE_ART.store;
        const centerX = node.x + (art.drawOffsetX || 0);
        const centerY = node.y + (art.drawOffsetY || 0) - art.height * (art.anchorY - 0.52);
        const rx = art.width * 0.34 + 34;
        const ry = art.height * 0.26 + 28;
        const nx = (x - centerX) / Math.max(1, rx);
        const ny = (y - centerY) / Math.max(1, ry);
        if (nx * nx + ny * ny <= 1) return true;
      }
      return false;
    };

    const queueTree = (worldX, worldY, scale, variantSeed, tiltSeed) => {
      if (nearRoadOrPark(worldX, worldY)) return;
      if (nearBuilding(worldX, worldY)) return;
      const screen = worldToScreen(worldX, worldY);
      const variantCount = TREE_VARIANT_POOL.length || TREE_VARIANT_PROFILES.length;
      const variantIndex = Math.min(variantCount - 1, Math.floor(variantSeed * variantCount));
      const profile = TREE_VARIANT_POOL[variantIndex] || TREE_VARIANT_PROFILES[0];
      const sizeJitter = 0.9 + variantSeed * 0.2;
      const drawScale = scale * profile.sizeMul * sizeJitter * 2;
      const targetWidth = 58 * drawScale;
      const targetHeight = 54 * drawScale;
      const anchorY = profile.anchorY ?? 0.82;
      const estimatedHeight = estimateAssetContainHeight(profile.assetId, targetWidth, targetHeight);
      const bottomY = screen.y + estimatedHeight * (1 - anchorY);
      treeQueue.push({ worldX, worldY, scale, variantSeed, tiltSeed, bottomY });
    };

    // Layer 3: orchard belt near farm for a stronger place identity.
    for (let ox = 0; ox < 10; ox += 1) {
      for (let oy = 0; oy < 5; oy += 1) {
        if (hash2D(ox, oy, 30) < 0.18) continue;
        const worldX = nodes.farm.x - 310 + ox * 78 + (hash2D(ox, oy, 33) - 0.5) * 52;
        const worldY = nodes.farm.y - 330 + oy * 74 + (hash2D(ox, oy, 34) - 0.5) * 46;
        queueTree(worldX, worldY, 0.86 + hash2D(ox, oy, 35) * 0.46, hash2D(ox, oy, 31), hash2D(ox, oy, 32));
      }
    }

    // Layer 4: scattered apple trees across the map with non-grid clustering.
    const treeStep = 150;
    const minTx2 = Math.floor(camera.x / treeStep) - 2;
    const maxTx2 = Math.floor((camera.x + VIEWPORT.width) / treeStep) + 2;
    const minTy2 = Math.floor(camera.y / treeStep) - 2;
    const maxTy2 = Math.floor((camera.y + VIEWPORT.height) / treeStep) + 2;

    for (let tx = minTx2; tx <= maxTx2; tx += 1) {
      for (let ty = minTy2; ty <= maxTy2; ty += 1) {
        const patchNoise = hash2D(Math.floor(tx / 3), Math.floor(ty / 3), 60);
        if (patchNoise < 0.08) continue; // keep only a few clearings.

        const attempts = patchNoise > 0.82 ? 5 : (patchNoise > 0.58 ? 4 : 3);
        for (let attempt = 0; attempt < attempts; attempt += 1) {
          const spawnNoise = hash2D(tx * 17 + attempt * 13, ty * 19 - attempt * 11, 61);
          const spawnThreshold = patchNoise > 0.86 ? 0.22 : (patchNoise > 0.66 ? 0.3 : 0.4);
          if (spawnNoise < spawnThreshold) continue;

          const jitterX = (hash2D(tx, ty, 62 + attempt * 7) - 0.5) * treeStep * 1.1;
          const jitterY = (hash2D(tx, ty, 63 + attempt * 7) - 0.5) * treeStep * 1.1;
          const flowX = Math.sin((ty + hash2D(tx, ty, 74)) * 0.92) * 24;
          const flowY = Math.cos((tx + hash2D(tx, ty, 75)) * 0.87) * 20;
          const worldX = tx * treeStep + jitterX + flowX;
          const worldY = ty * treeStep + jitterY + flowY;

          if (worldX < 40 || worldY < 40 || worldX > WORLD.width - 40 || worldY > WORLD.height - 40) continue;
          if (nearRoadOrPark(worldX, worldY)) continue;
          if (nearBuilding(worldX, worldY)) continue;

          // Small local clearings to break any remaining regularity.
          const microClear = hash2D(Math.floor(worldX / 115), Math.floor(worldY / 115), 70);
          if (microClear < 0.02) continue;

          queueTree(
            worldX,
            worldY,
            0.78 + hash2D(tx, ty, 64 + attempt * 5) * 0.62,
            hash2D(tx, ty, 65 + attempt * 5),
            hash2D(tx, ty, 66 + attempt * 5)
          );
        }
      }
    }

    // Painter's algorithm by each tree's lowest drawn pixel.
    treeQueue.sort((a, b) => a.bottomY - b.bottomY);
    for (const tree of treeQueue) {
      const screen = worldToScreen(tree.worldX, tree.worldY);
      drawWorldTree(screen.x, screen.y, tree.scale, tree.variantSeed, tree.tiltSeed);
    }
    return treeQueue;
  }

  function drawTreesInFrontOfPlayer(treeQueue) {
    if (!treeQueue || treeQueue.length === 0) return;
    const playerScreen = worldToScreen(player.x, player.y);
    const playerBottomY = playerScreen.y + 26;
    for (const tree of treeQueue) {
      if (tree.bottomY <= playerBottomY + 1) continue;
      const treeScreen = worldToScreen(tree.worldX, tree.worldY);
      if (Math.abs(treeScreen.x - playerScreen.x) > 96) continue;
      if (Math.abs(treeScreen.y - playerScreen.y) > 82) continue;
      drawWorldTree(treeScreen.x, treeScreen.y, tree.scale, tree.variantSeed, tree.tiltSeed);
    }
  }

  function drawText(value, x, y, color = COLORS.fg, size = 14, scaleMul = 1) {
    const scaledSize = Math.max(1, Math.round(size * TEXT_SCALE * scaleMul));
    ctx.fillStyle = color;
    ctx.font = `${scaledSize}px "PixelSmall", "PixelMiddle", "PixelHigh", monospace`;
    ctx.textBaseline = "top";
    ctx.fillText(value, x, y);
  }

  function drawFittedText(value, x, y, maxWidth, color = COLORS.fg, size = 14, scaleMul = 1, minScale = 0.55) {
    const baseSize = Math.max(1, Math.round(size * TEXT_SCALE * scaleMul));
    ctx.font = `${baseSize}px "PixelSmall", "PixelMiddle", "PixelHigh", monospace`;
    const measured = Math.max(1, ctx.measureText(value).width);
    const fitRatio = maxWidth > 0 ? Math.min(1, maxWidth / measured) : 1;
    const finalScale = clamp(fitRatio, minScale, 1);
    const finalSize = Math.max(1, Math.round(baseSize * finalScale));
    ctx.fillStyle = color;
    ctx.font = `${finalSize}px "PixelSmall", "PixelMiddle", "PixelHigh", monospace`;
    ctx.textBaseline = "top";
    ctx.fillText(value, x, y);
  }

  function drawBox(x, y, width, height, color = COLORS.panel) {
    ctx.fillStyle = color;
    ctx.fillRect(x, y, width, height);
    ctx.strokeStyle = COLORS.border;
    ctx.lineWidth = 2;
    ctx.strokeRect(x, y, width, height);
    
    // Pixel corners
    ctx.fillStyle = COLORS.border;
    ctx.fillRect(x - 2, y - 2, 4, 4);
    ctx.fillRect(x + width - 2, y - 2, 4, 4);
    ctx.fillRect(x - 2, y + height - 2, 4, 4);
    ctx.fillRect(x + width - 2, y + height - 2, 4, 4);
  }

  function formatTime(ms) {
    const totalSeconds = Math.ceil(ms / 1000);
    const minutes = Math.floor(totalSeconds / 60);
    const seconds = totalSeconds % 60;
    return `${minutes}:${String(seconds).padStart(2, "0")}`;
  }

  // ============================================================
  // SECTION 11: Render Layers (easy to replace for new graphics)
  // ============================================================
  function drawBackgroundLayer() {
    clearCanvas();

    // Layer 1: rolling hill patches for a Swiss-rural feel.
    const hillTile = 420;
    const minHx = Math.floor(camera.x / hillTile) - 2;
    const maxHx = Math.floor((camera.x + VIEWPORT.width) / hillTile) + 2;
    const minHy = Math.floor(camera.y / hillTile) - 2;
    const maxHy = Math.floor((camera.y + VIEWPORT.height) / hillTile) + 2;

    for (let hx = minHx; hx <= maxHx; hx += 1) {
      for (let hy = minHy; hy <= maxHy; hy += 1) {
        const worldX = hx * hillTile + lerp(-120, 120, hash2D(hx, hy, 51));
        const worldY = hy * hillTile + lerp(-110, 110, hash2D(hx, hy, 52));
        const hill = worldToScreen(worldX, worldY);
        const rx = 170 + Math.floor(hash2D(hx, hy, 53) * 85);
        const ry = 95 + Math.floor(hash2D(hx, hy, 54) * 55);
        const rot = hash2D(hx, hy, 55) * Math.PI;

        ctx.save();
        ctx.translate(hill.x, hill.y);
        ctx.rotate(rot);
        ctx.fillStyle = "rgba(110, 156, 96, 0.20)";
        ctx.beginPath();
        ctx.ellipse(0, 0, rx, ry, 0, 0, Math.PI * 2);
        ctx.fill();
        ctx.fillStyle = "rgba(188, 220, 152, 0.14)";
        ctx.beginPath();
        ctx.ellipse(-rx * 0.18, -ry * 0.16, rx * 0.72, ry * 0.62, 0, 0, Math.PI * 2);
        ctx.fill();
        ctx.restore();
      }
    }

    // Layer 2: large pasture and crop patches in world-space tiles.
    const tile = 220;
    const minTx = Math.floor(camera.x / tile) - 2;
    const maxTx = Math.floor((camera.x + VIEWPORT.width) / tile) + 2;
    const minTy = Math.floor(camera.y / tile) - 2;
    const maxTy = Math.floor((camera.y + VIEWPORT.height) / tile) + 2;

    for (let tx = minTx; tx <= maxTx; tx += 1) {
      for (let ty = minTy; ty <= maxTy; ty += 1) {
        const worldX = tx * tile + lerp(-35, 35, hash2D(tx, ty, 2));
        const worldY = ty * tile + lerp(-35, 35, hash2D(tx, ty, 6));
        const screen = worldToScreen(worldX, worldY);
        const n = hash2D(tx, ty, 9);
        const rx = 70 + Math.floor(hash2D(tx, ty, 10) * 40);
        const ry = 48 + Math.floor(hash2D(tx, ty, 11) * 30);
        const rot = hash2D(tx, ty, 12) * Math.PI;

        if (n < 0.38) ctx.fillStyle = "rgba(174, 211, 152, 0.45)";
        else if (n < 0.72) ctx.fillStyle = "rgba(198, 225, 170, 0.34)";
        else ctx.fillStyle = "rgba(224, 213, 153, 0.26)";

        ctx.save();
        ctx.translate(screen.x, screen.y);
        ctx.rotate(rot);
        ctx.beginPath();
        ctx.ellipse(0, 0, rx, ry, 0, 0, Math.PI * 2);
        ctx.fill();
        ctx.restore();

        // Crop-row texture for selected tiles.
        if (n > 0.74) {
          ctx.save();
          ctx.translate(screen.x, screen.y);
          ctx.rotate(rot + 0.35);
          ctx.strokeStyle = "rgba(124, 143, 94, 0.25)";
          ctx.lineWidth = 2;
          for (let i = -4; i <= 4; i += 1) {
            ctx.beginPath();
            ctx.moveTo(-rx + 10, i * 10);
            ctx.lineTo(rx - 10, i * 10);
            ctx.stroke();
          }
          ctx.restore();
        }
      }
    }

    // Layer 3: grass clumps, flowers, and stones.
    const detailStep = 72;
    const minDx = Math.floor(camera.x / detailStep) - 1;
    const maxDx = Math.floor((camera.x + VIEWPORT.width) / detailStep) + 1;
    const minDy = Math.floor(camera.y / detailStep) - 1;
    const maxDy = Math.floor((camera.y + VIEWPORT.height) / detailStep) + 1;
    for (let dx = minDx; dx <= maxDx; dx += 1) {
      for (let dy = minDy; dy <= maxDy; dy += 1) {
        const n = hash2D(dx, dy, 40);
        const worldX = dx * detailStep + Math.floor(hash2D(dx, dy, 41) * 36);
        const worldY = dy * detailStep + Math.floor(hash2D(dx, dy, 42) * 36);
        const p = worldToScreen(worldX, worldY);

        if (n > 0.66) {
          ctx.fillStyle = "rgba(118, 163, 96, 0.35)";
          ctx.fillRect(p.x, p.y, 6, 2);
          ctx.fillStyle = "rgba(103, 145, 82, 0.42)";
          ctx.fillRect(p.x + 2, p.y - 2, 3, 4);
        } else if (n < 0.12) {
          ctx.fillStyle = "rgba(255, 245, 225, 0.85)";
          ctx.fillRect(p.x, p.y, 2, 2);
          ctx.fillStyle = "rgba(230, 120, 100, 0.78)";
          ctx.fillRect(p.x + 2, p.y + 1, 2, 2);
          ctx.fillStyle = "rgba(255, 210, 115, 0.65)";
          ctx.fillRect(p.x - 1, p.y + 1, 2, 2);
        } else if (n > 0.34 && n < 0.39) {
          ctx.fillStyle = "rgba(120, 126, 132, 0.25)";
          ctx.fillRect(p.x, p.y, 3, 2);
        }
      }
    }

    // Layer 4: soft atmospheric transition to avoid hard-cut terrain patches.
    const skyFade = ctx.createLinearGradient(0, 0, 0, VIEWPORT.height);
    skyFade.addColorStop(0, "rgba(246, 255, 236, 0.2)");
    skyFade.addColorStop(0.52, "rgba(212, 236, 188, 0.06)");
    skyFade.addColorStop(1, "rgba(160, 190, 142, 0.08)");
    ctx.fillStyle = skyFade;
    ctx.fillRect(0, 0, VIEWPORT.width, VIEWPORT.height);

    const vignette = ctx.createRadialGradient(
      VIEWPORT.width * 0.5,
      VIEWPORT.height * 0.42,
      VIEWPORT.width * 0.1,
      VIEWPORT.width * 0.5,
      VIEWPORT.height * 0.46,
      VIEWPORT.width * 0.72
    );
    vignette.addColorStop(0, "rgba(255, 255, 255, 0)");
    vignette.addColorStop(1, "rgba(70, 88, 60, 0.08)");
    ctx.fillStyle = vignette;
    ctx.fillRect(0, 0, VIEWPORT.width, VIEWPORT.height);
  }

  function drawRoadLayer() {
    const strokeRoadPath = (road) => {
      ctx.beginPath();
      const first = worldToScreen(road[0].x, road[0].y);
      ctx.moveTo(first.x, first.y);
      for (let i = 1; i < road.length; i += 1) {
        const point = worldToScreen(road[i].x, road[i].y);
        ctx.lineTo(point.x, point.y);
      }
      ctx.stroke();
    };

    ctx.lineJoin = "round";
    ctx.lineCap = "round";

    // 1) Gravel shoulder around asphalt.
    ctx.strokeStyle = "#cbb893";
    ctx.lineWidth = ROAD_RADIUS * 2 + 28;
    for (const road of roads) strokeRoadPath(road);

    // 2) Soft edge shadow.
    ctx.strokeStyle = "rgba(63, 56, 50, 0.28)";
    ctx.lineWidth = ROAD_RADIUS * 2 + 12;
    for (const road of roads) strokeRoadPath(road);

    // 3) Main asphalt.
    ctx.strokeStyle = "#8fa5be";
    ctx.lineWidth = ROAD_RADIUS * 2;
    for (const road of roads) strokeRoadPath(road);

    // 4) Worn lane center texture.
    ctx.strokeStyle = "rgba(255,255,255,0.08)";
    ctx.lineWidth = Math.max(2, ROAD_RADIUS * 2 - 16);
    for (const road of roads) strokeRoadPath(road);

    // 5) Edge guide marks.
    ctx.strokeStyle = "rgba(255,255,255,0.25)";
    ctx.lineWidth = 2;
    ctx.setLineDash([8, 20]);
    for (const road of roads) strokeRoadPath(road);

    // 6) Center dashed lane.
    ctx.strokeStyle = "rgba(255, 225, 145, 0.8)";
    ctx.lineWidth = 3;
    ctx.setLineDash([16, 20]);
    ctx.lineDashOffset = -(Date.now() / 90);
    for (const road of roads) strokeRoadPath(road);

    ctx.setLineDash([]);
    ctx.lineDashOffset = 0;
  }

  function drawPlaceLayer() {
    const parkStyles = {
      farm: { fill: "rgba(166, 118, 78, 0.32)", ring: "rgba(247, 220, 111, 0.7)" },
      market: { fill: "rgba(121, 183, 226, 0.28)", ring: "rgba(250, 215, 160, 0.8)" },
      store: { fill: "rgba(140, 176, 210, 0.3)", ring: "rgba(214, 234, 248, 0.8)" },
      factory: { fill: "rgba(130, 136, 140, 0.28)", ring: "rgba(219, 223, 228, 0.8)" },
    };
    for (const [id, park] of Object.entries(parks)) {
      const screenPark = worldToScreen(park.x, park.y);

      const style = parkStyles[id] || parkStyles.store;
      const node = nodes[id];
      const screenNode = worldToScreen(node.x, node.y);
      const art = PLACE_ART[id] || PLACE_ART.store;
      const buildingX = screenNode.x + (art.drawOffsetX || 0);
      const buildingY = screenNode.y + (art.drawOffsetY || 0);
      const entryX = buildingX + art.entryX;
      const entryY = buildingY + art.entryY;
      const transitionTint =
        id === "farm"
          ? "rgba(211, 184, 136, 0.52)"
          : id === "market"
            ? "rgba(215, 202, 172, 0.5)"
            : id === "factory"
              ? "rgba(190, 192, 198, 0.42)"
              : "rgba(196, 208, 221, 0.42)";

      // Ambient halo to blend building art into world background.
      const ambientGlow = ctx.createRadialGradient(
        buildingX,
        buildingY - art.height * 0.22,
        Math.max(18, art.width * 0.08),
        buildingX,
        buildingY + art.height * 0.12,
        Math.max(90, art.width * 0.72)
      );
      ambientGlow.addColorStop(0, "rgba(255,255,255,0.14)");
      ambientGlow.addColorStop(0.6, "rgba(230,236,219,0.08)");
      ambientGlow.addColorStop(1, "rgba(230,236,219,0)");
      ctx.fillStyle = ambientGlow;
      ctx.beginPath();
      ctx.ellipse(buildingX, buildingY + 8, art.width * 0.6, art.height * 0.48, 0, 0, Math.PI * 2);
      ctx.fill();

      // Path from building entrance to parking/trade point.
      ctx.strokeStyle = "rgba(235, 223, 195, 0.9)";
      ctx.lineWidth = 10;
      ctx.lineCap = "round";
      ctx.beginPath();
      ctx.moveTo(entryX, entryY);
      ctx.lineTo(screenPark.x, screenPark.y);
      ctx.stroke();

      // Parking/trade circle.
      ctx.fillStyle = style.fill;
      ctx.beginPath();
      ctx.arc(screenPark.x, screenPark.y, park.r, 0, Math.PI * 2);
      ctx.fill();

      ctx.strokeStyle = style.ring;
      ctx.lineWidth = 4;
      ctx.setLineDash([10, 5]);
      ctx.beginPath();
      ctx.arc(screenPark.x, screenPark.y, park.r, 0, Math.PI * 2);
      ctx.stroke();
      ctx.setLineDash([]);

      // Building shadow plate.
      ctx.fillStyle = "rgba(0, 0, 0, 0.16)";
      ctx.beginPath();
      ctx.ellipse(buildingX, buildingY + 20, art.width * 0.3, art.height * 0.09, 0, 0, Math.PI * 2);
      ctx.fill();

      // Contact fade where structure meets terrain.
      const contactFade = ctx.createRadialGradient(
        entryX,
        entryY + 8,
        8,
        entryX,
        entryY + 12,
        Math.max(56, art.width * 0.46)
      );
      contactFade.addColorStop(0, transitionTint);
      contactFade.addColorStop(0.68, "rgba(214, 206, 180, 0.12)");
      contactFade.addColorStop(1, "rgba(214, 206, 180, 0)");
      ctx.fillStyle = contactFade;
      ctx.beginPath();
      ctx.ellipse(entryX, entryY + 12, Math.max(54, art.width * 0.44), Math.max(20, art.height * 0.16), 0, 0, Math.PI * 2);
      ctx.fill();

      const drewBuilding = drawAsset(art.assetId, buildingX, buildingY, art.width, art.height, {
        anchorX: 0.5,
        anchorY: art.anchorY,
        fit: art.fit || "contain",
      });

      if (!drewBuilding) {
        const fallbackColor = id === "farm" ? COLORS.farm : id === "market" ? COLORS.market : id === "factory" ? COLORS.factory : COLORS.store;
        ctx.fillStyle = fallbackColor;
        ctx.fillRect(buildingX - 56, buildingY - 60, 112, 78);
        ctx.strokeStyle = COLORS.border;
        ctx.lineWidth = 3;
        ctx.strokeRect(buildingX - 56, buildingY - 60, 112, 78);
      }

      if (id === "factory") {
        const time = Date.now() / 1000;
        ctx.fillStyle = "rgba(210, 214, 218, 0.52)";
        for (let i = 0; i < 5; i += 1) {
          const off = (time + i * 0.4) % 1.8;
          ctx.beginPath();
          ctx.arc(
            buildingX + art.smokeX + Math.sin(time * 2 + i) * 5,
            buildingY + art.smokeY - off * 34,
            4 + off * 4,
            0,
            Math.PI * 2
          );
          ctx.fill();
        }
      }

      const placeLabel = PLACES[id].graphicLabel || PLACES[id].name;
      const labelWidth = Math.max(120, placeLabel.length * 10);
      const labelX = buildingX - Math.floor(labelWidth / 2);
      const labelY = buildingY + art.labelOffsetY;
      ctx.fillStyle = "rgba(255, 250, 240, 0.92)";
      ctx.fillRect(labelX, labelY, labelWidth, 22);
      ctx.strokeStyle = COLORS.border;
      ctx.lineWidth = 2;
      ctx.strokeRect(labelX, labelY, labelWidth, 22);
      drawText(placeLabel, labelX + 6, labelY + 2, COLORS.fg, 8);
    }
  }

  function drawPlayerLayer() {
    const screen = worldToScreen(player.x, player.y);
    // Draw shadow first
    ctx.fillStyle = "rgba(0,0,0,0.2)";
    ctx.beginPath();
    ctx.ellipse(screen.x, screen.y + 10, 20, 10, player.rotation, 0, Math.PI * 2);
    ctx.fill();

    let vanRotation = player.rotation - Math.PI / 2;
    const vanFlipX = Math.cos(vanRotation) < 0;
    if (vanFlipX) vanRotation += Math.PI;

    const drewVan = drawAsset("van", screen.x, screen.y, 92, 58, {
      rotation: vanRotation,
      anchorX: 0.5,
      anchorY: 0.55,
      flipX: vanFlipX,
    });
    if (!drewVan) drawPixelSprite("van", screen.x, screen.y, 2.5, player.rotation);
  }

  function drawHudLayer() {
    const outerMargin = 10;
    const hudHeight = 126;
    const hudWidth = Math.min(1180, VIEWPORT.width - outerMargin * 2);
    const hudX = Math.floor((VIEWPORT.width - hudWidth) / 2);
    const hudY = 8;

    // Compact centered HUD panel.
    ctx.fillStyle = COLORS.panel;
    ctx.fillRect(hudX, hudY, hudWidth, hudHeight);
    ctx.strokeStyle = COLORS.border;
    ctx.lineWidth = 2;
    ctx.strokeRect(hudX, hudY, hudWidth, hudHeight);

    const charX = hudX + 40;
    const charY = hudY + hudHeight - 4;
    const nameX = hudX + 98;
    const timeX = hudX + Math.floor(hudWidth * 0.39);
    const moneyX = hudX + Math.floor(hudWidth * 0.54);
    const invX = hudX + Math.floor(hudWidth * 0.39);
    const actionX = hudX + Math.floor(hudWidth * 0.73);

    // Left group: character + identity.
    const hudCharacterAsset = characterAssetId(player.character.id);
    const drewHudCharacter = drawAsset(hudCharacterAsset, charX, charY, 82, 108, {
      anchorX: 0.5,
      anchorY: 1,
      sourceBounds: resolveHudCharacterSourceBounds(hudCharacterAsset),
    });
    if (!drewHudCharacter) drawPixelSprite(player.character.id, charX, charY, 5.2, 0);
    drawText("SPIELER*IN", nameX, hudY + 12, COLORS.muted, 10);
    drawText(player.character.name.toUpperCase(), nameX, hudY + 31, COLORS.fg, 18);

    // Middle columns: time and money.
    drawText("ZEIT", timeX, hudY + 12, COLORS.muted, 10);
    drawText(formatTime(state.timeLeftMs), timeX, hudY + 31, COLORS.fg, 18);
    drawText("GELD", moneyX, hudY + 12, COLORS.muted, 10);
    drawText(`${player.cash.toFixed(2)} CHF`, moneyX, hudY + 31, COLORS.accent, 18);

    const total = invCount(player.inventory);
    drawText(`WAGEN: ${total} / ${player.capacity}`, nameX, hudY + 74, COLORS.muted, 13);

    // Inventory row.
    const invY = hudY + 90;
    const drewPremium = drawAsset(appleAssetId("premium"), invX, invY, 27, 27, { anchorX: 0.5, anchorY: 0.5 });
    if (!drewPremium) drawPixelSprite("apple_premium", invX, invY, 1.2, 0);
    drawText(player.inventory.premium.toString(), invX + 18, invY - 12, COLORS.fg, 12);

    const drewNormal = drawAsset(appleAssetId("normal"), invX + 92, invY, 27, 27, { anchorX: 0.5, anchorY: 0.5 });
    if (!drewNormal) drawPixelSprite("apple_normal", invX + 92, invY, 1.2, 0);
    drawText(player.inventory.normal.toString(), invX + 110, invY - 12, COLORS.fg, 12);

    const drewCheap = drawAsset(appleAssetId("cheap"), invX + 184, invY, 27, 27, { anchorX: 0.5, anchorY: 0.5 });
    if (!drewCheap) drawPixelSprite("apple_cheap", invX + 184, invY, 1.2, 0);
    drawText(player.inventory.cheap.toString(), invX + 202, invY - 12, COLORS.fg, 12);

    // Right group: context/action.
    const activePark = parkAt(player.x, player.y);
    if (activePark) {
      const action = activePark === "farm" ? "EINKAUF" : "VERKAUF";
      drawText("AKTION:", actionX, hudY + 74, COLORS.muted, 10);
      drawText(`ENTER: ${PLACES[activePark].name} (${action})`, actionX, hudY + 95, COLORS.accent, 14);
    } else {
      drawText("STEUERUNG:", actionX, hudY + 74, COLORS.muted, 10);
      drawText("PFEILE/WASD FAHREN | ENTER HANDELN", actionX, hudY + 95, COLORS.muted, 10);
    }
  }

  function drawPauseModal(modalX, modalY, modalWidth, modalHeight) {
    drawText("Pause", modalX + 16, modalY + 16);
    const options = ["Weiter", "Neustart"];
    for (let i = 0; i < options.length; i += 1) {
      const marker = i === state.listSelection ? "> " : "  ";
      drawText(`${marker}${options[i]}`, modalX + 18, modalY + 70 + i * 30, COLORS.fg, 12);
    }
    drawText("Enter waehlen | Esc zurueck", modalX + 18, modalY + modalHeight - 36, COLORS.muted, 12);
  }

  function drawTradeModal(modal, modalX, modalY, modalWidth, modalHeight) {
    const isBuy = modal.type === "buy";
    
    // Header
    ctx.fillStyle = COLORS.header;
    ctx.fillRect(modalX, modalY, modalWidth, 45);
    ctx.strokeStyle = COLORS.border;
    ctx.lineWidth = 2;
    ctx.strokeRect(modalX, modalY, modalWidth, 45);
    
    const title = isBuy ? "Bauernhof - Einkauf" : `${PLACES[modal.placeId].name} - Verkauf`;
    drawText(title, modalX + 15, modalY + 12, COLORS.fg, 18);
    drawText(isBuy ? "WAGEN BELADEN" : "MIT HANDEL GELD VERDIENEN", modalX + 320, modalY + 15, COLORS.muted, 10);

    // Body
    drawBox(modalX, modalY + 45, modalWidth, modalHeight - 125, COLORS.panel);
    
    const rows = modalRows(modal);
    const rowStartY = modalY + 65;
    for (let i = 0; i < rows.length; i += 1) {
      const row = rows[i];
      const y = rowStartY + i * 65;
      const isSelected = i === state.listSelection;
      
      if (isSelected) {
        ctx.fillStyle = "rgba(230, 126, 34, 0.1)";
        ctx.fillRect(modalX + 10, y - 5, modalWidth - 20, 60);
      }

      const marker = isSelected ? "> " : "  ";
      const drewModalApple = drawAsset(appleAssetId(row.id), modalX + 45, y + 25, 56, 56, { anchorX: 0.5, anchorY: 0.5 });
      if (!drewModalApple) drawPixelSprite(`apple_${row.id}`, modalX + 45, y + 25, 4, 0);
      
      drawText(`${marker}${row.label.toUpperCase()}`, modalX + 80, y, COLORS.fg, 14);
      drawText(`${row.left}`, modalX + 80, y + 20, COLORS.muted, 10);
      drawText(`${row.right}`, modalX + 240, y + 20, COLORS.muted, 10);
      if (row.extra) drawText(`${row.extra}`, modalX + 80, y + 38, COLORS.muted, 8);
      
      // Amount selection area (repositioned to avoid overlap)
      drawText(`AUSGEW.`, modalX + 480, y + 5, COLORS.muted, 9);
      drawText(`${state.cart[row.id] || 0}`, modalX + 500, y + 20, COLORS.accent, 16);
      drawText(`L/R AENDERN`, modalX + 460, y + 45, COLORS.muted, 8);
    }

    // Footer
    const footerY = modalY + modalHeight - 80;
    drawBox(modalX, footerY, modalWidth, 80, COLORS.header);
    
    const planned = cartTotal();
    const inventoryNow = invCount(player.inventory);
    
    if (isBuy) {
      drawText(`WAGEN: ${Math.min(player.capacity, inventoryNow + planned)}/${player.capacity}`, modalX + 20, footerY + 15, COLORS.muted, 12);
      drawText(`KOSTEN:`, modalX + 200, footerY + 15, COLORS.fg, 12);
      drawText(`${formatCHF(cartCost())}`, modalX + 200, footerY + 35, COLORS.accent, 18);
      drawText("ENTER = EINKAUFEN", modalX + 400, footerY + 45, COLORS.muted, 10);
    } else {
      drawText(`WAGEN: ${Math.max(0, inventoryNow - planned)}/${player.capacity}`, modalX + 20, footerY + 15, COLORS.muted, 12);
      drawText(`ERLOES:`, modalX + 200, footerY + 15, COLORS.fg, 12);
      drawText(`${formatCHF(planned * modal.pricePerApple)}`, modalX + 200, footerY + 35, COLORS.accent, 18);
      drawText("ENTER = VERKAUFEN", modalX + 400, footerY + 45, COLORS.muted, 10);
    }
  }

  function drawModalLayer() {
    if (!state.modal) return;
    ctx.fillStyle = COLORS.panel;
    ctx.fillRect(0, 0, VIEWPORT.width, VIEWPORT.height);

    const modalX = 140;
    const modalY = 110;
    const modalWidth = 620;
    const modalHeight = 360;
    drawBox(modalX, modalY, modalWidth, modalHeight);

    if (state.modal.type === "pause") {
      drawPauseModal(modalX, modalY, modalWidth, modalHeight);
      return;
    }
    drawTradeModal(state.modal, modalX, modalY, modalWidth, modalHeight);
  }

  function drawTitleScreen() {
    const titleScale = 0.88;
    drawBackgroundLayer();
    
    // Main Title Area
    drawBox(100, 30, 700, 85, COLORS.panel);
    drawFittedText("APFEL, FERTIG, LOS!", 150, 40, 620, COLORS.fg, 32, titleScale);
    drawFittedText("EIN SCHWEIZER LANDHANDEL-ABENTEUER VON R151 STUDIO", 155, 80, 620, COLORS.muted, 10, titleScale);
    
    // Character Selection
    drawFittedText("WAEHLE DEINE*N FAHRER*IN", 360, 130, 260, COLORS.fg, 14, titleScale);
    
    const charWidth = 240;
    const charHeight = 280;
    const charGap = 40;
    const totalWidth = 3 * charWidth + 2 * charGap;
    const startX = (VIEWPORT.width - totalWidth) / 2;
    const startY = 160;

    const descriptions = {
      lenny: "SCHNELLER FAHRER. SCHWACHES VERHANDLUNGSTALENT",
      julia: "SORGFAELTIGE FAHRERIN. AUSGEWOGEN.",
      simo: "VERHANDLUNGSPROFI. KLEINER WAGEN. KEIN KAPITAL",
    };
    const traitLabels = { low: "NIEDRIG", medium: "MITTEL", high: "HOCH" };

    for (let i = 0; i < CHARACTERS.length; i += 1) {
      const character = CHARACTERS[i];
      const isSelected = i === state.selectedCharacterIndex;
      const x = startX + i * (charWidth + charGap);
      
      // Card Background
      drawBox(x, startY, charWidth, charHeight, isSelected ? COLORS.header : COLORS.panel);
      if (isSelected) {
        ctx.strokeStyle = COLORS.accent;
        ctx.lineWidth = 4;
        ctx.strokeRect(x, startY, charWidth, charHeight);
      }

      // Large character sprite
      const drewTitleCharacter = drawAsset(characterAssetId(character.id), x + charWidth / 2, startY + 126, 216, 244, {
        anchorX: 0.5,
        anchorY: 1,
        fit: "contain",
      });
      if (!drewTitleCharacter) drawPixelSprite(character.id, x + charWidth / 2, startY + 126, 8.2, 0);
      
      drawFittedText(character.name.toUpperCase(), x + 20, startY + 130, 180, COLORS.fg, 18, titleScale);
      
      // Stats
      drawFittedText(`GESCHWINDIGKEIT: ${traitLabels[character.speed]}`, x + 20, startY + 160, 190, COLORS.muted, 10, titleScale);
      drawFittedText(`VERHANDLUNGSTALENT: ${traitLabels[character.negotiation]}`, x + 20, startY + 175, 190, COLORS.muted, 10, titleScale);
      drawFittedText(`SORGFALT IM STAPELN: ${traitLabels[character.care]}`, x + 20, startY + 190, 190, COLORS.muted, 10, titleScale);
      
      // Description (shortened to avoid overlap)
      drawFittedText(descriptions[character.id] || "", x + 20, startY + 220, 190, COLORS.fg, 10, titleScale);
      
      if (isSelected) {
        drawFittedText("BEREIT!", x + 20, startY + 250, 190, COLORS.accent, 12, titleScale);
      }
    }

    drawFittedText("PFEILE WAEHLEN | ENTER STARTEN", 340, 480, 300, COLORS.muted, 10, titleScale);
    if (artAssets.loaded + artAssets.failed < artAssets.total) {
      drawFittedText(`BILDER LADEN: ${artAssets.loaded}/${artAssets.total}`, 320, 14, 260, COLORS.muted, 8, titleScale);
    }
  }

  function drawGameOverBanner() {
    if (state.timeLeftMs > 0) return;
    ctx.fillStyle = "rgba(0, 0, 0, 0.45)";
    ctx.fillRect(220, 210, 460, 90);
    drawBox(220, 210, 460, 90);
    drawText("Zeit abgelaufen", 240, 230, COLORS.accent, 18);
    drawText(`Endstand: ${player.cash.toFixed(2)} CHF`, 240, 258, COLORS.fg, 14);
  }

  function drawGameScene() {
    drawBackgroundLayer();
    drawRoadLayer();
    const treeQueue = drawTreeLayer();
    drawPlaceLayer();
    drawPlayerLayer();
    drawTreesInFrontOfPlayer(treeQueue);
    drawHudLayer();
    drawGameOverBanner();
    drawModalLayer();
  }

  // ============================================================
  // SECTION 12: Update Loop + Automation Hooks
  // ============================================================
  function update(dt) {
    if (state.mode !== "play") return;
    if (state.modal && state.modal.type === "pause") return;

    state.timeLeftMs = Math.max(0, state.timeLeftMs - dt * 1000);
    if (!state.modal && state.timeLeftMs > 0) movePlayer(dt);
    updateCamera(dt);
  }

  function render() {
    if (state.mode === "title") {
      drawTitleScreen();
      return;
    }
    drawGameScene();
  }

  function renderGameToText() {
    const payload = {
      coordinateSystem: "Ursprung oben links; +x rechts; +y unten; Welt-Einheiten in Pixeln",
      mode: state.mode,
      timeLeftMs: Math.round(state.timeLeftMs),
      player: {
        x: Number(player.x.toFixed(2)),
        y: Number(player.y.toFixed(2)),
        vx: Number(player.vx.toFixed(2)),
        vy: Number(player.vy.toFixed(2)),
        atPark: parkAt(player.x, player.y),
        cash: Number(player.cash.toFixed(2)),
        capacity: player.capacity,
        inventory: { ...player.inventory },
      },
      modal: state.modal ? { type: state.modal.type, placeId: state.modal.placeId || null } : null,
      demands: {
        market: { ...state.needs.market },
        store: { ...state.needs.store },
        factory: { ...state.needs.factory },
      },
    };
    return JSON.stringify(payload);
  }

  window.render_game_to_text = renderGameToText;
  window.advanceTime = (ms) => {
    const frameMs = 1000 / 60;
    const steps = Math.max(1, Math.round(ms / frameMs));
    const dt = (ms / steps) / 1000;
    for (let i = 0; i < steps; i += 1) update(dt);
    render();
  };

  let previousTimestamp = performance.now();
  function tick(now) {
    const dt = Math.min(0.05, (now - previousTimestamp) / 1000);
    previousTimestamp = now;
    update(dt);
    render();
    requestAnimationFrame(tick);
  }

  requestAnimationFrame(tick);
})();
</script>
</body>
</html>




